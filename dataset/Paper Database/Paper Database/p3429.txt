Analysis of KITTI Data for Stereo Analysis
with Stereo ConÔ¨Ådence Measures
Ralf Haeusler and Reinhard Klette
The University of Auckland
Computer Science Department
Tamaki Campus
Abstract. The recently published KITTI stereo dataset provides a new
quality of stereo imagery with partial ground truth for benchmarking
stereo matchers. Our aim is to test the value of stereo conÔ¨Ådence measures (e.g. a left-right consistency check of disparity maps, or an analysis
of the slope of a local interpolation of the cost function at the taken
minimum) when applied to recorded datasets, such as published with
KITTI. We choose popular measures as available in the stereo-analysis
literature, and discuss a naive combination of these. Evaluations are carried out using a sparsiÔ¨Åcation strategy. While the best single conÔ¨Ådence
measure proved to be the right-left consistency check for high disparity
map densities, the best overall performance is achieved with the proposed naive measure combination. We argue that there is still demand
for more challenging datasets and more comprehensive ground truth.
Introduction
Computational stereo vision is in general an ill-posed problem, and solutions are
approximate in some sense. Situations with no unique solutions are commonly
found in recorded stereo images. Also with strong assumptions imposed to resulting disparity maps, such as piecewise smoothness, no stereo matcher can
guarantee correct results.
Widely used test datasets often use input data of limited complexity .
On these, recently developed stereo matchers deliver dense results of satisfactory quality. However, in practice, recorded real-world data are considerably
more challenging; see, e.g., . There may be no satisfactory solution to the
stereo problem in many situations displayed in these datasets. For treating unmatchable regions in disparity maps, there are some attempts to identify these
using so-called conÔ¨Ådence measures.
To evaluate quality of stereo matching results and accuracy of detected mismatches by means of conÔ¨Ådence measures, availability of accurate ground truth
is necessary. However, real-world stereo data in are provided without ground
truth. Recently published stereo-vision test data , in the paper brieÔ¨Çy called
KITTI data, show real-world scenes and come with ground truth provided by a
laser range-scanner. In this paper, we try to rate the challenge given by KITTI
data and quantify the value of conÔ¨Ådence measures in dealing with such datasets.
A. Fusiello et al. (Eds.): ECCV 2012 Ws/Demos, Part II, LNCS 7584, pp. 158‚Äì167, 2012.
‚ÉùSpringer-Verlag Berlin Heidelberg 2012
Analysis of KITTI Data with Stereo ConÔ¨Ådence Measures
ConÔ¨Ådence measures can be used in stereo processing to remove spurious disparity matches and interpolate these locations with surrounding disparity values.
The left-right consistency check is the most prominent example. Various conÔ¨Ådence measures have been proposed for stereo analysis; see . Experimental
studies of quantitative evaluations of conÔ¨Ådence measures have been conducted
(on very limited datasets) in . By using the KITTI data, we also discuss
conÔ¨Ådence measures on a larger set of real-world data.
Many conÔ¨Ådence measures are derived from the graph of cost functions. For
example, consider a parabola Ô¨Åt of the cost function at the taken minimum and
its neighbourhood. The minimum of this parabola can be used to interpolate
disparity with subpixel accuracy. Parameter a deÔ¨Ånes the curvature of such a
parabola ax2 + bx + c, and this value is often considered to be a conÔ¨Ådence
measure. In it is applied with the intention to improve results for scene Ô¨Çow
computations. An equivalent conÔ¨Ådence measure can be deÔ¨Åned using the slope
of an Okutomi Ô¨Åt , and this may be more appropriate, depending on the stereo
matching cost function used.
However, a conÔ¨Ådence measure that only operates locally on the cost function
cannot assign, for example, low conÔ¨Ådence to ambiguous matches within repetitive textures of the source image. Improved results can be expected when the
costs of all disparity values are taken into account. This was demonstrated by 
for the 3D reconstruction of large outdoor scenes where conÔ¨Ådence is high if the
cost function has a single well-deÔ¨Åned minimum, and low if the cost function is
Ô¨Çat or has multiple strong local minima. It is an open question which conÔ¨Ådence
measure has the best performance in a particular matching situation.
Very little has been published on improving the accuracy of conÔ¨Ådence measures by combining diÔ¨Äerent measures. For example, see for conÔ¨Ådence measures in optical Ô¨Çow computations, using a supervised learning process of Gaussian mixture models with classiÔ¨Åcation criteria being the magnitude of the end
point error in optic Ô¨Çow. However, it remained open whether this conÔ¨Ådence
measure (obtained as a result of classiÔ¨Åcation in feature space) could actually
improve accuracy. In , Ô¨Çow data is assigned to algorithms found most suitable by classiÔ¨Åcation, based on a combination of Ô¨Çow conÔ¨Ådence features such as
photo consistency and texture properties. used similar features for detecting
diÔ¨Écult to match Ô¨Çow regions in order to test whether these regions are occluded.
In both, classiÔ¨Åcation results are obtained using random decision forests.
In this paper we include a naive approach for conÔ¨Ådence measure combinations for stereo, which seems to be useful in increasing accuracy, i.e. is reducing
numbers of false positives. Also, we deÔ¨Åne a simple bound for limits of potential
accuracy improvements by measure combinations. We apply this measure and a
number of popular stereo conÔ¨Ådence measures to the recently published KITTI
dataset , and evaluate them using a similar sparsiÔ¨Åcation strategy as used in
Section 2 contains the deÔ¨Ånitions of conÔ¨Ådence measures used in this paper,
including a multiplicative combination and an upper bound for accuracy improvements. Section 3 presents the evaluation method for the performance of
R. Haeusler and R. Klette
measures and provides details about experiments conducted. Section 4 presents
results. Section 5 discusses limitations of conÔ¨Ådence measures and of the used
KITTI dataset. Section 6 concludes.
ConÔ¨Ådence Measures for Stereo Analysis
For our experiments, we use semi-global matching (SGM) for stereo analysis 
due to its best overall performance on synthetic and recorded outdoor data in
terms of quality and computational costs. The data term in the original version
of SGM stereo is derived from a mutual information measure . However, 
concludes that the census cost function leads to the best overall performance.
ConÔ¨Ådence measures used in this study are not deÔ¨Åned on census costs directly,
but on census costs aggregated using SGM with penalty parameters p1 = 20 and
p2 = 100. In the following, we denote these aggregated cost A.
A compilation of diÔ¨Äerent conÔ¨Ådence measures can be found in . We
selected measures which appear to be pairwise ‚Äúfairly diÔ¨Äerent‚Äù by their definitions, with an intention to obtain the best possible performance boost by
combining ‚Äúorthogonal measures‚Äù. This is, of course, possible only to a limited
extent. All conÔ¨Ådence measures presented here are deÔ¨Åned pixelwise. No dependency from neighbouring pixels is introduced, except the dependency deÔ¨Åned by
cost aggregation. Contrary to the common practice, we scale values such that
lower values indicate a smaller likelihood of an erroneous disparity estimate (i.e.
a higher conÔ¨Ådence).This facilitates the comparison to actual disparity errors.
We deÔ¨Åne and use the following measures, with d0 representing the estimated
disparities D(x, y):
‚Äì Curvature. Curvature derived from parabola Ô¨Åtting is a very popular stereo
conÔ¨Ådence measure. It is the only conÔ¨Ådence measure in the source code of
 . We are using the inverse of the opening parameter for scaling:
Œì0(x, y) =
‚àí2A(x,y)(d0) + A(x,y)(d0 ‚àí1) + A(x,y)(d0 + 1)
‚Äì Perturbation. The perturbation measure, introduced in , computes the
deviation from an ideal cost function that has a single minimum at location
d0 and is very large everywhere else. Nonlinear scaling is applied:
Œì1(x, y) =
e‚àí(A(x,y)(d0)‚àíA(x,y)(d))
The parameter œÇ should be chosen such that no numerical underÔ¨Çows appear.
A good choice depends on the range of possible valid cost values.
‚Äì Peak ratio. The peak ratio indicates low conÔ¨Ådence if there are two candidates with similar matching score. It is deÔ¨Åned as
Œì2(x, y) = A(x,y)(d0)/A(x,y)(d1)
Analysis of KITTI Data with Stereo ConÔ¨Ådence Measures
where d1 is the second smallest local minimum, i.e. A(x,y)(d1‚àí1) > A(x,y)(d1)
and A(x,y)(d1 + 1) > A(x,y)(d1). Not requiring a local minimum but only the
second smallest cost value yields a measure similar to parabola curvature.
‚Äì Entropy. Entropy deÔ¨Åned on the disparity space was used in steering a diffusion process for cost aggregation in stereo matching . It can be used
as a conÔ¨Ådence measure itself. Cost values are normalized for computing the
entropy. Here, p indicates that cost values are converted into a probability
distribution function:
Œì3(x, y) = ‚àí
p(d) log p(d)
e‚àíA(x,y)(d)
d‚Ä≤ e‚àíA(x,y)(d‚Ä≤)
Similar to the perturbation measure Œì1, cost values for all disparities in-
Ô¨Çuence the result. All cost values undergo nonlinear scaling, making these
measures computationally rather expensive.
‚Äì Right-left consistency check. Right-left consistency compares the disparities
of the left and right view, denoted by D and D(r):
Œì4(x, y) =
D(x,y) ‚àíD(r)
Large discrepancies, intuitively, should indicate a higher likelihood of an
incorrect match. We are also interested in Ô¨Ånding out whether there is conÔ¨Ådence information extractable from disparities given with subpixel precision,
D(x,y) ‚àíD(r)
‚Äì Combination of measures. We deÔ¨Åne a measure combination Œì by multiplying all Ô¨Åve measures deÔ¨Åned above:
Œì(x, y) = Œì0(x, y)Œì1(x, y)Œì2(x, y)Œì3(x, y)Œì4(x, y)
Note that this is not justiÔ¨Åed in the sense of joint probabilities. Measures
are not pairwise independent. Correlation is quite strong as their deÔ¨Ånition
is derived from same cost values A.
‚Äì Accuracy. Ideally conÔ¨Ådence measures exactly predict the magnitude of the
error in disparity estimation, so as to discard largest errors Ô¨Årst. For comparison with Œì0, . . . , Œì4 and Œì we include this ideal measure, given by the
absolute diÔ¨Äerence Œî between disparity estimate D and ground truth G:
D(x,y) ‚àíG(x,y)
In practise, Ô¨Ånding such a conÔ¨Ådence measure was equivalent to the stereo
problem being solved.
Thus, it is more realistic to compare a combination of conÔ¨Ådence measures rather
against a measure that identiÔ¨Åes an error if at least one of the contributing
conÔ¨Ådence measures can detect it. The amount of remaining errors s is then
the cardinality of the union set of all undetected erroneous pixels for a speciÔ¨Åc
sparsiÔ¨Åcation œÜ of the disparity map D:
s(œÜ) = card
D(x,y)|(x, y) ‚ààŒ© ‚àßŒî(x, y) > 3 ‚àß‚àÄi (Œìi(x, y) ‚â§Œ≥i(œÜ))
R. Haeusler and R. Klette
Here, Œ≥i(œÜ) is the value of the conÔ¨Ådence measure Œìi which induces a sparsiÔ¨Åcation œÜ. Note, that values from this deÔ¨Ånition cannot be derived without ground
truth. It merely gives a lower limit of remaining disparity errors. The bad-pixel
criterion is deviation of estimated disparities from ground truth being larger
than 3. This is in accordance with the default in and due to limited accuracy
of laser range Ô¨Ånder measurements.
Evaluation of ConÔ¨Ådence Measures
We test SGM stereo and derived conÔ¨Ådence measures on a small subset of the
recently introduced KITTI Dataset . We choose stereo frames which expose
some interesting behaviour, e.g. the ones challenging for SGM stereo. Challenging
are considered the frames which produce most errors in comparison to ground
truth. We also include two frames where only few errors between SGM results
and ground truth can be observed.
For comparisons, we use raw disparities D, i.e. do not attempt to improve
results by consistency checks, interpolation, median Ô¨Åltering, or any other kind of
postprocessing. Any such steps may introduce some bias to Ô¨Åndings. However, we
exclude such disparities from evaluation, which have been found to be occluded
according to the method described in . It may be beneÔ¨Åcial, to use occlusion
ground truth instead, if such was available with .
Furthermore, we restrict the evaluation to pixels where:
‚Äì Ground truth is available. In KITTI data there is no ground truth for upper
parts of images, areas usually depicting sky in road vehicle based recordings.
‚Äì The cost function contains valid values for all possible disparities. This excludes the left image border in the left view with its width equalling the
number of disparities, the reason being scaling issues in the presense of unknown cost values in the deÔ¨Ånition of conÔ¨Ådence measures based on the entire
cost function.
‚Äì Disparity estimates are supported by data term values, i.e. we do not rely on
extrapolation introduced by SGM. This excludes a narrow band along the
image border (e.g. 3 pixels for a 7 √ó 7 cost matching window).
A sparsiÔ¨Åcation function is computed by summing the remaining errors of matching results when a certain percentile of the disparity map is Ô¨Åltered according to
the locations having least conÔ¨Ådence assigned. Locations with lowest conÔ¨Ådence
are removed Ô¨Årst.
Measure comparisons often refer to the area under the sparsiÔ¨Åcation curve.
However, errors for very sparse maps are of little interest and should not bias a
comparison of conÔ¨Ådence measures. Thus, we do not compare the areas under
the sparsiÔ¨Åcation curves. We are merely interested in measure performance for
disparity map densities in a range corresponding to proportions of good disparity
pixels, typically between 70 % and 95 % when using the SGM stereo algorithm
without postprocessing disparities on the KITTI dataset (see intersection of
ground truth optimum with x-axis in Figures 2 and 3).
Analysis of KITTI Data with Stereo ConÔ¨Ådence Measures
000008.png
000043.png
000071.png
000082.png
000087.png
000094.png
000120.png
000122.png
000128.png
000180.png
Fig. 1. Visualization of stereo results without postprocessing (left column) and laser
range Ô¨Ånder ground truth (right column) of frames included in this study. Close objects
are red, distant objects green.
R. Haeusler and R. Klette



!"#
$%&$
*+
-&(.##
#
#
 !"#


 !"


 !"#





!"#
$
*+
-&(.##
#
#
 !"


 !"


 !"


Fig. 2. SparsiÔ¨Åcation plots for selected frames of KITTI data with high amount of bad
pixels in the evaluation domain excluding locations detected as being occluded by the
stereo matcher. Numbers of remaining bad pixels are plotted against disparity map
Recall that Frames 8 and 128 were selected due to their apparent amenability
to the stereo problem. The illustration in Fig. 1, however, reveals that low error
rates are only a result of missing ground truth in locations where stereo solutions
Analysis of KITTI Data with Stereo ConÔ¨Ådence Measures




" #$"
()
+$&,!!



!"#!
 

Fig. 3. SparsiÔ¨Åcation plots for selected frames of KITTI data with low amount of bad
pixels in the evaluation domain excluding locations detected as being occluded by the
stereo matcher. Numbers of remaining bad pixels are plotted against disparity map
are not accurate. Nevertheless, this may not corrupt an evaluation of conÔ¨Ådence
measures, as these areas are ignored.
SparsiÔ¨Åcation plots in Figures 2 and 3 show that the curvature conÔ¨Ådence
measure Œì0 in general identiÔ¨Åes disparity errors much less accurately than other
conÔ¨Ådence measures included in this study. In Frame 43 the selection of bad
pixels appears to be almost random (straight line). However on Frame 43, depicting some vegetation in close proximity, other conÔ¨Ådence measures also do
not seem to work well. Useful accuracy of Œì0, according to our experiments, can
be observed in Frames 8 and 122.
The remainder of conÔ¨Ådence measures, regarding accuracy, is almost on a
par at low sparsiÔ¨Åcations. From the measures Œì1 to Œì4, the entropy conÔ¨Ådence
measure Œì3 is most often the worst one. The left-right consistency check is not
helpful within higher sparsiÔ¨Åcations, especially not if Œì4 < 1.
For most frames, the naive combination Œì of conÔ¨Ådence measures outperforms
single conÔ¨Ådence measures at a sparsiÔ¨Åcation determined by numbers of bad
pixels. However, the left-right consistency check Œì4 can be on a par at this
sparsiÔ¨Åcation level.
Regarding the proposed bound for combined conÔ¨Ådence measures it can be
found that at the level of sparsiÔ¨Åcation necessary to remove all bad pixels, there
is usually a remainder of half the amount of bad pixels found by the proposed
combination Œì, which cannot be identiÔ¨Åed by any conÔ¨Ådence measure.
Discussion
In the following, we discuss accuracy of conÔ¨Ådence measures on the frames included in this study and try, where possible, to link their behaviour to scene
structure and quality of ground truth and stereo results.
The curvature conÔ¨Ådence measure, although widely used, is not much better than randomly removing pixels. Reasons may include limited sharpness of
R. Haeusler and R. Klette
recorded images. This measure only performs rather well on Frames 8 and 122.
This Ô¨Ånding may not be signiÔ¨Åcant for Frame 8, due to low numbers of bad
pixels involved. The reason for apparently improved accuracy of curvature on
Frame 122 may be the detection of homogeneously textured areas on road surfaces, which are wrongly estimated by SGM stereo. For detection of textureless
areas, however, there may exist better indicators, such as the structural tensor
That, in all frames, the consistency check Œì4 does not perform well at higher
sparsiÔ¨Åcations is not surprising, as subpixel estimation only is based on interpolated cost function values and therefore compromised by so-called pixel locking.
However, the consistency check is also not successful in detecting errors resulting
from surface over-extension or foreground fattening , as these occur likewise
in left-right and right-left matching.
Frame 87 visually does not seem to contain 20 percent bad pixels showing
in Fig. 2. Also, conÔ¨Ådence measures do not detect these bad pixels well. Such
results pose the question whether a Ô¨Åxed tolerance of 3 pixel for disparity errors
is appropriate. In particular, in practise, it may be advantageous to deÔ¨Åne error
tolerance based on physical distance and with a lower limit in disparity space.
Another problem of the KITTI dataset is missing ground truth in large image
areas. It is most often absent where image regions are challenging for stereo. This
is, e.g., the case on fences (Frames 94 and 128) and car windows (Frames 82,
120 and 180). However, it should be noted that there is no agreement or even no
approach regarding evaluation strategies for such image regions exposing stereo
matchers to semi-transparencies.
Conclusion
Compared to previous benchmark data which was recorded under controlled
lighting conditions, some frames of KITTI data are more challenging for computational stereo due to outdoor scenes with suboptimal lighting conditions.
However, extremely diÔ¨Écult recordings of road scenarios are absent. To our experience, these include tunnels, back-light, night scenes with street lights and
lights of other traÔ¨Éc participants, wet road surfaces and precipitation.
Missing ground truth at locations challenging for stereo vision reduces the
signiÔ¨Åcance of our Ô¨Åndings and makes it hard to draw comprehensive conclusions.
A comprehensive analysis, however, can be conducted if suÔ¨Éciently diversiÔ¨Åed
datasets with ground truth are available. Apart from the low coverage with
ground truth at interesting image locations, another shortcoming of the KITTI
dataset is the low dynamic range and luminance resolution of the imagery. Being
eight bit only, preventable stereo problems are introduced, which may disguise
more interesting problems. We conclude that a suÔ¨Éciently challenging and rich
dataset for stereo benchmarking with ground truth is not yet available.
Analysis of KITTI Data with Stereo ConÔ¨Ådence Measures