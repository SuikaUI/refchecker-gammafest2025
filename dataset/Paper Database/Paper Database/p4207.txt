Estimating divergence functionals and the likelihood
ratio by convex risk minimization
XuanLong Nguyen
Dept. of Statistical Science
Duke University
 
Martin J. Wainwright
Dept. of Statistics, and Dept. of EECS
University of California, Berkeley
 
Michael I. Jordan
Dept. of Statistics, and Dept. of EECS
University of California, Berkeley
 
Revised April 15, 2009
Technical Report 764
Department of Statistics
University of California, Berkeley
We develop and analyze M-estimation methods for divergence functionals and the likelihood
ratios of two probability distributions. Our method is based on a non-asymptotic variational
characterization of f-divergences, which allows the problem of estimating divergences to be
tackled via convex empirical risk optimization. The resulting estimators are simple to implement,
requiring only the solution of standard convex programs. We present an analysis of consistency
and convergence for these estimators. Given conditions only on the ratios of densities, we show
that our estimators can achieve optimal minimax rates for the likelihood ratio and the divergence
functionals in certain regimes. We derive an eﬃcient optimization algorithm for computing our
estimates, and illustrate their convergence behavior and practical viability by simulations.1
Introduction
Divergences (or pseudo-distances) based on likelihood ratios between pairs of multivariate probability distribution densities play a central role in information theory and statistics. For instance,
in the asymptotic analysis of hypothesis testing, the Kullback-Leibler and Chernoﬀdivergences
control the decay rates of error probabilities (e.g., see Stein’s lemma and its variants). As a
particular case of the Kullback-Leibler divergence, the mutual information speciﬁes capacities in
1Preliminary versions of this work were presented at the International Symposium on Information Theory 
 and the Neural Information Processing Systems Conference .
channel coding coding and data compression . In statistical machine learning and signal processing, divergences between probability distributions are frequently exploited as metrics to be
optimized, such as in independent component analysis and decentralized detection .
In all of these settings, an important problem is that of divergence estimation: how to estimate
the divergence between two multivariate probability distributions, say P and Q, based on a set of
samples from each distribution? A canonical example is estimation of the Kullback-Leibler (KL)
divergence from samples. This problem includes as a special case the problem of estimating the
mutual information, corresponding to the KL divergence between a joint distribution and the product of its marginals, as well as the problem of estimating the Shannon entropy of a distribution P,
which is related to the KL divergence between P and the uniform distribution. Several researchers
have studied the problem of Shannon entropy estimation based on various types of nonparametric techniques. Somewhat more generally, the problem of estimating an integral functional
of a single density has been studied extensively, dating back to early work from 1970s, and
continuing on in later research . More recent recent work by Wang et al. has developed
algorithms for estimating the KL divergence between a pair of continuous distributions P and Q,
based on building data-dependent partitions of equivalent (empirical) Q-measure. Wang et al. 
also proposed an interesting nonparametric estimator of the KL divergence using 1-nearest neighbor
technique. Both estimators were empirically shown to outperform direct plug-in methods, but no
theoretical results on convergence rates were provided.
In this paper, we propose methods for estimating divergence functionals as well as likelihood
density ratios based on simple M-estimators. Although our primary interest is the Kullback-Leibler
divergence, our methodology is more broadly applicable to the class of Ali-Silvey distances, also
known as f-divergences . Any divergence in this family, to be deﬁned more formally in the
sequel, is of the form Dφ(P, Q) =
φ(dQ/dP)dP, where φ is a convex function of the likelihood
ratio dQ/dP.
Our estimation method is motivated by a non-asymptotic characterization of f-divergence, due
independently to several authors . Roughly speaking, the main theorem in states
that that there is a correspondence between the family of f-divergences and a family of losses such
that the minimum risk is equal to the negative of the divergence. In other words, any negative
f-divergence can serve as a lower bound for a risk minimization problem. This correspondence
provides a variational characterization, by which the divergence Dφ(P, Q) can be expressed as the
maximum of an Bayes decision problem involving two hypotheses P and Q. In this way, as we
show in this paper, estimating the divergence Dφ(P, Q) has an equivalent reformulation as solving
a certain Bayes decision problem. This reformulation leads to an M-estimation procedure, in which
the divergence is estimated by solving the convex program deﬁned by the Bayes decision problem.
This approach not only leads to an M-estimation procedure for the divergence but also for the
likelihood ratio dP/dQ.
Our second contribution is to analyze the convergence and consistency properties of our estimators, under certain assumptions on the permitted class G of density ratios, or logarithms of density
ratios. The analysis makes use of some known results in empirical process theory for nonparametric
density estimation . The key technical condition is the continuity of the suprema of two
empirical processes, induced by P and Q distributions respectively, with respect to a metric deﬁned
on the class G of permitted functions. This metric arises as a surrogate lower bound of a Bregman
divergence deﬁned on a pair of density ratios. If G is a smooth function class with smooth parameter α > d/2, it can be shown that our estimates of the likelihood ratio and the KL divergence are
both optimal in the minimax sense with the rate n−α/(d+2α) and n−1/2, respectively.
Our third contribution is to provide an eﬃcient implementation of one version of our estimator,
in which the function class G is approximated by a reproducing kernel Hilbert space (RKHS) .
After computing the convex dual, the estimator can be implemented by solving a simple convex program involving only the Gram matrix deﬁned by the kernel associated with the RKHS.
Our method thus inherits the simplicity of other kernel-based methods used in statistical machine
learning . We illustrate the empirical behavior of our estimator on various instances of KL
divergence estimation.
The remainder of this paper is organized as follows. In Section 2, we provide the variational
characterization of f-divergences in general, and KL divergence in particular. We then develop an
M-estimator for the KL divergence and the likelihood ratio. Section 3 is devoted to the analysis of
consistency and convergence rates of these estimators. In Section 4, we develop an eﬃcient kernelbased method for computing our M-estimates, and provide simulation results demonstrating their
performance. In Section 5, we discuss our estimation method and its analysis in a more general
light, encompassing a broader class of f-divergences. We conclude in Section 6.
Notation: For convenience of the reader, we summarize some notation to be used throughout the
paper. Given a probability distribution P and random variable f measureable with respect to P, we
fdP to denote the expectation of f under P. When P is absolutely continuous with respect to
Lesbesgue measure, say with density p0, this integral is equivalent to the usual Lebesgue integral
f(x)p0(x)µ(dx). Given samples X(1), . . . , X(n) from P, the empirical distribution Pn is
given by Pn = 1
i=1 δX(i), corresponding to a sum of delta functions centered at the data points.
fdPn as a convenient short-hand for the empirical expectation 1
i=1 f(X(i)).
M-estimators for KL divergence and the density ratio
We begin by deﬁning f-divergences, and describing a variational characterization in terms of a Bayes
decision problem. We then exploit this variational characterization to develop an M-estimator.
Variational characterization of f-divergence
Consider two probability distributions P and Q, with P absolutely continuous with respect to
Q. Assume moreover that both distributions are absolutely continuous with respect to Lebesgue
measure µ, with densities p0 and q0, respectively, on some compact domain X ⊂Rd. The Kullback-
Leibler (KL) divergence between P and Q is deﬁned by the integral
This divergence is a special case of a broader class of divergences known as Ali-Silvey distances or
f-divergence , which take the form
p0φ(q0/p0) dµ,
where φ : R →R is a convex and lower semi-continuous (l.s.c.) function. Diﬀerent choices of φ
result in many divergences that play important roles in information theory and statistics, including
not only the KL divergence (1) but also the total variational distance, the Hellinger distance, and
so on; see for further examples.
We begin by stating and proving a variational representation for the divergence Dφ. In order
to do so, we require some basic deﬁnitions from convex analysis . The subdiﬀerential ∂φ(t)
of the convex function φ at a point t ∈R is the set
{z ∈R | φ(s) ≥φ(t) + z (s −t)
As a special case, if φ is diﬀerentiable at t, then ∂φ(t) = {φ′(t)}. The function φ∗is the conjugate
dual function associated with φ, deﬁned as
{u v −φ(u)} .
With these deﬁnitions, we have:
Lemma 1. For any class of functions F mapping from X to R, we have the lower bound
Dφ(P, Q) ≥sup
[f dQ −φ∗(f) dP] .
Equality holds if and only if the subdiﬀerential ∂φ(q0/p0) contains an element of F.
Proof. Since φ is convex and lower semi-continuous, Fenchel convex duality guarantees that we
can write φ in terms of its conjugate dual as φ(u) = supv∈R
. Consequently, we have
(fq0/p0 −φ∗(f)) dµ
[fq0 −φ∗(f)p0] dµ
[f dQ −φ∗(f) dP] ,
where the supremum is taken over all measurable functions f : X →R. It is simple to see that
equality in the supremum is attained at a function f such that q0/p0 ∈∂φ∗(f) where q0, p0 and f
are evaluated at any x ∈X. By convex duality, this is true if f ∈∂φ(q0/p0) for any x ∈X.
M-estimators for the KL divergence and likelihood ratio
We now describe how the variational representation (5) specializes to an M-estimator for the
Kullback-Leibler (KL) divergence. As a particular f-divergence, the KL divergence is induced by
the convex function
A short calculation shows that the conjugate dual takes the form
−1 −log(−v)
if u < 0, and
otherwise.
As a consequence of Lemma 1, we obtain the following representation of the Kullback-Leibler
divergence: DK(P, Q) = supf<0
[−1 −log(−f)]dP. After the substitution g = −f, this
can be written as
DK(P, Q) = sup
log g dP −
for which the supremum is attained at g0 = p0/q0.
We now take a statistical perspective on the variational problem (8), where we assume that the
distributions P and Q are unknown. We suppose that we are given independent and identically distributed (i.i.d.) samples, say X(1), X(2), . . . , X(n) drawn i.i.d. from P, and Y (1), Y (2), . . . , Y (n) drawn
i.i.d. from Q. Denote by Pn the empirical distribution deﬁned by the samples {X(1), . . . , X(n)}, given
explicitly by Pn := 1
i=1 δX(i), with the empirical distribution Qn associated with {Y (1), . . . , Y (n)}
deﬁned analogously. We consider two classes of estimators:
Estimator E1:
Given the empirical distributions, we consider the estimator obtained by replacing
the true distributions P and Q with their empirical versions, and maximizing over some pre-speciﬁed
class G of functions g : X →R+, as follows:
bgn = argmaxg∈G
log g dPn −
log bgn dPn −
bgn dQn + 1.
Assuming that G is a convex set of functions, the implementation of the estimator requires solving
a convex optimization problem, albeit over an (inﬁnite-dimensional) function space. For this estimation method to work, several conditions on G are required. First, so as to control approximation
error, it is natural to require that G is suﬃciently rich so as to contain the true likelihood ratio g0
in the sense of KL divergence, i.e., there is some g ∈G such that g = g0 a.e.. On the other hand,
G should not be too large, so that estimation is possible. To formalize this condition, let I(g) be
a measure of complexity for g, where I is a non-negative functional and I(g0) < ∞. Given some
ﬁxed ﬁnite constant M∗≥I(g0), we then deﬁne
G := GM∗:= {g : I(g) ≤M∗}.
Estimator E2:
In practice, the “true” I(g0) is not known, and hence it is not clear as a practical
matter how to choose the ﬁxed M∗deﬁning estimator E1. Thus we also consider an approach that
involves an explicit penalty I(g). In this approach, let
G = ∪1≤M≤∞GM.
The estimation procedure involves solving the following program:
log g dPn + λn
log bgn dPn −
bgn dQn + 1,
where λn > 0 is a regularization parameter.
As we discuss in Section 4, for function classes deﬁned by reproducing kernel Hilbert spaces,
problems (9b) and (12a) can actually be posed as a ﬁnite-dimensional convex programs (in n
dimensions), and solved eﬃciently by standard methods. In addition to the estimate bDK of the
KL divergence, if the supremum is attained at bgn, then bgn is an M-estimator of the density ratio
g0 := p0/q0.
In the next section, we present results regarding the consistency and convergence rates of both
estimators. While these methods have similar convergence behavior, estimator E1 is somewhat
simpler to analyze and admits weaker conditions for consistency. On the other hands, estimator E2
seems more practical. Details of algorithmic derivations for estimator E2 are described in Section 4.
Consistency and convergence rate analysis
For the KL divergence functional, the diﬀerence | bDK −DK(P, Q)| is a natural performance measure.
For estimating the density ratio function, this diﬀerence can also be used, although more direct
metrics are customarily preferred. In our analysis, we view g0 = p0/q0 as a density function with
respect to Q measure, and adopt the (generalized) Hellinger distance as a performance measure for
estimating the likelihood ratio function:
Q(g0, g) := 1
(√g0 −√g)2 dQ.
Consistency of estimator E1
Our analysis of consistency relies on tools from empirical process theory. Let us brieﬂy review the
notion of the metric entropy of function classes (see, e.g., for further background). For any
r ≥1 and distribution function Q, deﬁne the empirical Lr metric
and let Lr(Q) denote the metric space deﬁned by this distance. For any ﬁxed δ > 0, a covering for
function class G using the metric Lr(Q) is a collection of functions which allow G to be covered using
Lr(Q) balls of radius δ centered at these functions. Letting Nδ(G, Lr(Q)) be the smallest cardinality
of such a covering, then Hδ(G, Lr(Q)) := log Nδ(G, Lr(Q)) is called the entropy for G using the Lr(Q)
metric. A related notion is entropy with bracketing. Let N B
δ (G, Lr(Q)) be the smallest value of N
for which there exist pairs of functions {gL
j } such that ∥gU
j ∥Lr(Q) ≤δ, and such that for
each g ∈G there is a j such that gL
j . Then HB
δ (G, Lr(Q)) := log N B
δ (G, Lr(Q)) is called
the entropy with bracketing of G. Deﬁne the envelope functions:
G0(x) = sup
G1(x) = sup
| log g(x)
For the estimator E1, we impose the following assumptions on the distributions P, Q and the
function class G.
Assumptions.
(A). The KL divergence is bounded: DK(P, Q) < ∞.
(B). There is some g ∈G such that g = g0 almost surely (a.s.).
In the following theorem, the almost sure statement can be taken with respect to either P or Q
since they share the same support.
Theorem 1. Suppose that assumptions (A) and (B) hold.
(a) Assume the envelope conditions
and suppose that for all δ > 0 there holds:
nHδ(G −g0, L1(Qn))
nHδ(log G/g0, L1(Pn))
Then, | bDK −DK(P, Q)| a.s.
−→0, and hQ(g0, bgn) a.s.
(b) Suppose only that (15a) and (16a) hold, and
nHδ(log G + g0
Then hQ(g0, bgn) a.s.
To provide intuition for the conditions of Theorem 1, note that the envelope condition (15a) is
relatively mild, satisﬁed (for instance) if G is uniformly bounded from above. On the other hand,
the envelope condition (15b) is much more stringent. Due to the logarithm, this can be satisﬁed
if all functions in G are bounded from both above and below. However, as we see in part (b),
we do not require boundedness from below; to ensure Hellinger consistency we can drop both the
envelope condition (15b) and the entropy condition (16b), replacing them with the milder entropy
condition (17).
It is worth noting that both (16a) and (17) can be deduced from the following single condition:
for all δ > 0, the bracketing entropy satisﬁes
δ (G, L1(Q)) < ∞.
Indeed, given equation (15a) and by the law of large numbers, condition (18) directly implies (16a).
To establish condition (17), note that by a Taylor expansion, we have
log g1 + g0
−log g2 + g0
nHδ(log G+g0
2g0 , L1(Pn)) ≤1
nHδ(G/g0, L1(Pn)). Since G0 ∈L1(Q), we have G0/g0 ∈L1(P).
In addition, HB
δ (G/g0, L1(P)) ≤HB
δ (G, L1(Q)) < ∞. By the law of large numbers, the metric
entropy Hδ(G/g0, L1(Pn)) is bounded in probability, so that condition (17) holds.
In practice, the entropy conditions are satisﬁed by a variety of function classes.
include various types of reproducing kernel Hilbert spaces , as described in more detail in
Section 4, as well as the Sobolev classes, which we describe in the following example.
Example 1 (Sobolev classes). Let κ = (κ1, . . . , κd) be a d-dimensional multi-index, where all κi
are natural numbers. Given a vector x ∈Rd, deﬁne xκ := Qd
and |κ| := Pd
i=1 κi. For a
suitably diﬀerentiable function f, let Dκ denote the multivariate diﬀerential operator
1 . . . ∂xκd
f(x1, . . . , xd),
and deﬁne the norm ∥f∥2
2 (X) := P
|Dκf(x)|2 dx.
With this notation, we deﬁne the norm
2 (X) := ∥f∥L2(X) + ∥f∥Lα
and the Sobolev space W α
2 (X) of functions with ﬁnite ∥f∥W α
2 (X)-norm.
Suppose that the domain X is a compact subset of Rd. Let the complexity measure I be the Sobolev norm—that is,
I(g) := ∥g∥W α
r (X). With this choice of complexity measure, it is known that the function class
G deﬁned in equation (10) satisﬁes, for any δ > 0, the metric entropy bound
for all smoothness indices α > d/2. As a result, both conditions (18) and (16b) hold if, for instance,
G is restricted to a subset of smooth functions that are bounded from above, and g0 is bounded
from below.
Proof of Theorem 1
We now turn to the proof of Theorem 1, beginning with part (a). Deﬁne the following quantities
associated with the function class G:
DK(P, Q) −sup
(log g dP −g dQ + 1) ≥0
log g d(Pn −P) −gd(Qn −Q)
The quantity E0 is the approximation error, which measures the bias incurred by limiting the
optimization to the class G. The term E1 is the estimation error associated with the class G. Our
focus in this paper is the statistical problem associated with the estimation error E1, and thus we
have imposed assumption (B), which implies that the approximation error E0(G) = 0. Moreover,
from equations (8) and (9b), straightforward algebra yields that
| bDK −DK(P, Q)|
E0(G) + E1(G) = E1(G).
Accordingly, the remainder of the proof is devoted to analysis of the estimation error E1(G).
In order to analyze E1(G), deﬁne the following processes:
d(Pn −P) −
(g −g0)d(Qn −Q)
log g0 d(Pn −P) −g0d(Qn −Q)
Note that we have
E1(G) ≤vn(G) + wn(g0).
Note that the quantity wn(g0) is the diﬀerence between an empirical and a population expectation. Let us verify that the conditions for the strong law of large numbers (SLN) apply. Using
the inequality
p0| log(p0/q0)| ≤DK(P, Q) + 4
due to Csisz´ar (cf. ), it follows that log g0 is P integrable. In addition, the function g0 is Q integrable, since
(p0/q0)dQ = 1. Thus, the SLN applies, and we conclude that wn(g0) a.s.
By applying Theorem 5 from Appendix G, we conclude that vn(G) a.s.
−→0. From the decomposition
in equation (26), we conclude that E1(G) a.s.
−→0, so that | bDK −DK(P, Q)| a.s.
To establish Hellinger consistency of the likelihood ratio, we require the following lemma, whose
proof is in Appendix A:
Lemma 2. Deﬁning the “distance” d(g0, g) :=
(g −g0)dQ −log g
g0dP, the following statements
(i) For any g ∈G, we have d(g0, g) ≥2h2
(ii) For the estimate bgn deﬁned in equation (9a), we have d(g0, bgn) ≤vn(G).
The Hellinger consistency hQ(g0, bgn) a.s.
−→0 of Theorem 1(a) is an immediate consequence of this
Turning now to Theorem 1 (b), we require a more reﬁned lemma relating the Hellinger distance
to suprema of empirical processes.
Lemma 3. If bgn is an estimate of g, then:
Q(g0, bgn) ≤2h2
Q(g0, g0 + bgn
d(Qn −Q) +
log bgn + g0
See Appendix B for the proof of this claim.
To complete the proof of Theorem 1, deﬁne
G2(x) = supg∈G | log g(x)+g0(x)
Due to Lemma 3 and standard results from empirical process
theory (see Appendix G, Theorem 5) it is suﬃcient to prove that
G2dP < ∞. To establish this
claim, note that
g(x) + g0(x)
|g(x) −g0(x)|dQ
where the last inequality (a) is due to envelope condition (15a).
Convergence rates
In this section, we describe convergence rates for both estimator E1 and estimator E2. The key
technical tool that we use to analyze the convergence rate for the likelihood ratio estimate is
Lemma 3, used previously in the proof of Theorem 1. This lemma bounds the Hellinger distance
hQ(g0, bgn) in terms of the suprema of two empirical processes writh respect to P and Q.
nutshell, the suprema of these two empirical processes can be bounded from above in terms of the
Hellinger distance, which allows us to obtain the rates at which the Hellinger distance goes to zero.
Convergence rates for estimator E1
In order to characterize convergence rates for the estimator E1, we require one of the following two
conditions:
0 < K1 ≤inf
x g(x) ≤K2
We also require the following assumption on function class ¯G := {((g + g0)/2)1/2, g ∈G}: for some
constant 0 < γ ¯G < 2, there holds for any δ > 0,
δ ( ¯G, L2(Q)) = O(δ−γ ¯
Combining this metric entropy decay rate with condition (27a), we deduce that for G, the bracketing
entropy satisﬁes
δ (G, L2(Q)) = O(δ−γ ¯
With these deﬁnitions, we can now state a result characterizing the convergence rate of estimator
E1, where the notation OP means “bounded in probability” with respect to P measure.
Theorem 2 (Convergence rates for estimator E1).
(a) If conditions (27a) and (28) hold, then
hQ(g0, bgn) = OP(n−1/(γ ¯
(b) If conditions (27b) and (28) hold, then | bDK −DK(P, Q)| = OP(n−1/2).
Remarks: In order to gain intuition for the convergence rate in part (a), it can be instructive to
compare to the minimax rate
EP [hQ(g0, bgn)],
where the supremum is taken over all pairs (P, Q) such that g0 ∈G. As a concrete example, if we
take G as the Sobolev family from Example 1, and if condition (27b) holds, then the minimax rate
is rn = Ω(n−1/(γ+2)), where γ = γ ¯G = d/α (see Appendix E). Thus, we see that for the Sobolev
classes, the estimator E1 achieves the minimax rate for estimating the likelihood ratio in Hellinger
distance. In addition, the rate n−1/2 for the divergence estimate is also optimal.
Convergence rates for estimator E2
We now turn to a discussion of the convergence rates of estimator E2. To analyze this estimator,
we assume that
I(g0) < ∞,
and moreover we assume that the true likelihood ratio g0—but not necessarily all of G—is bounded
from above and below:
0 < η0 ≤g0 ≤η1 for some constants η0, η1.
We also assume that the sup-norm over GM is Lipschitz with respect to the penalty measure I(g),
meaning that there is a constant c < ∞such that for each M ≥1, we have
Finally, we assume that the bracketing entropy of G satisﬁes, for some 0 < γ < 2, the condition
δ (GM, L2(Q)) = O [(M/δ)γ]
Given these assumptions, we then state the following convergence rate result for the estimator E2:
Theorem 3. (a) Suppose that assumptions (30) through (33) hold, and that the regularization
parameter λn →0 is chosen such that
Then under P, we have
hQ(g0, bgn) = OP(λ1/2
(b) Suppose that in addition to assumptions (30) through (33), there holds inf
g∈G g(x) ≥η0. Then
| bDK −DK(P, Q)| = OP(n−1/2).
Remarks: Note that with the choice λ−1
 n2/(2+γ)
and the special case of G as the Sobolev
2 (X) (see Example 1), estimator E2 again achieves the minimax rate for estimating the
density ratio in Hellinger distance.
Proof of convergence theorems
In this section we present a proof of Theorem 3. The proof of Theorem 2 is similar in spirit, and
is provided in Appendix D. The key to our analysis of the convergence rate of estimator E2 is the
following lemma, which can be viewed as the counterpart of Lemma 3:
Lemma 4. If bgn is an estimate of g using (12a), then:
Q(g0, bgn) + λn
2 I2(bgn) ≤−
(bgn −g0)d(Qn −Q) +
2 log bgn + g0
d(Pn −P) + λn
See Appendix C for the proof of this lemma. Equipped with this auxiliary result, we can now prove
Theorem 3(a). Deﬁne fg := log g+g0
2g0 , and let FM := {fg
g ∈GM}. Since fg is a Lipschitz
function of g, conditions (31) and (33) imply that
δ (FM, L2(P)) = O {(M/δ)γ} .
Applying Lemma 5.14 from van de Geer using the distance d2(g0, g) = ∥g −g0∥L2(Q), we have
that the following statement holds under Q, and hence holds under P as well, since dP/dQ is
bounded from above:
(g −g0)d(Qn −Q)|
n−1/2d2(g0, g)1−γ/2(1 + I(g) + I(g0))γ/2 ∨n−
2+γ (1 + I(g) + I(g0))
In the same vein, we obtain that under P,
fgd(Pn −P)|
n−1/2d2(g0, g)1−γ/2(1 + I(g) + I(g0))γ/2 ∨n−
2+γ (1 + I(g) + I(g0))
Now using condition (32), it can be veriﬁed that
d2(g0, g) = ∥g −g0∥L2(Q) ≤2c1/2(1 + I(g) + I(g0))1/2hQ(g0, g).
Combining Lemma 4 and equations (38) and (37), we conclude that
Q(g0, bgn) + λn
2 I2(bgn) ≤λnI(g0)2/2
n−1/2hQ(g0, g)1−γ/2(1 + I(g) + I(g0))1/2+γ/4 ∨n−
2+γ (1 + I(g) + I(g0))
From this point, the proof involves simple algebraic manipulation of (39). To simplify notation, let
bh = hQ(g0, bgn), bI = I(bgn), and I0 = I(g0). We break the analysis into four cases, depending on the
behavior of bh and bI:
Case A:. In this case, we assume bh ≥n−1/(2+γ)(1 + bI + I0)1/2 and bI ≥1 + I0. From (39), we have
bh2/4 + λnbI2/2 ≤OP(n−1/2)bh1−γ/2 bI1/2+γ/4 or bh2/4 + λnbI2/2 ≤λnI2
These conditions imply, respectively, either
OP(n−2/(2+γ)),
n OP(n−2/(2+γ)),
bh ≤OP(λ1/2
bI ≤OP(I0).
In either case, we conclude the proof by setting λ−1
= OP(n2/(γ+2)(1 + I0)).
Case B. In this case, we assume that bh ≥n−1/(2+γ)(1+bI+I0)1/2 and bI < 1+I0. From equation (39),
we have either
bh2/4 + λnbI2/2 ≤OP(n−1/2)bh1−γ/2(1 + I0)1/2+γ/4,
bh2/4 + λnbI2/2 ≤λnI2
These conditions imply, respectively, that
bh ≤(1 + I0)1/2OP(n−1/(γ+2)),
bI ≤1 + I0
bh ≤OP(λ1/2
bI ≤OP(I0).
In either case, the proof is concluded by setting λ−1
= OP(n2/(γ+2)(1 + I0)).
Case C. In this case, we assume that bh ≤n−1/(2+γ)(1+bI+I0)1/2 and bI ≥1+I0. From equation (39),
bh2/4 + λnbI2/2 ≤OP(n−2/(2+γ))bI,
which implies that bh ≤OP(n−1/(2+γ))bI1/2 and bI ≤λ−1
n OP(n−2/(2+γ)). Consequently, by setting
= OP(n2/(2+γ))(1 + I0), we obtain
bh ≤OP(λ1/2
n )(1 + I0),
bI ≤OP(1 + I0).
Case D. In this ﬁnal case, we assume that bh ≤n−1/(2+γ)(1 + bI + I0)1/2 and bI ≤1 + I0, and the
claim of Theorem 3(a) follows.
We now proceed to the proof of Theorem 3(b). Note that part (a) and equation (32) imply that
∥bgn∥∞= OP(1 + I(g0)). Without loss of generality, assume that 0 < η0 ≤g0(x) and bgn(x) ≤η1 for
all x ∈X. Then we have
bDK −DK(P, Q)
log bgndPn −
log g0dP −
log bgnd(Pn −P) −
bgnd(Qn −Q) =: T1
bDK −DK(P, Q)
log g0d(Pn −P) −
g0d(Qn −Q) =: T2
We have T2 = OP(n−1/2) by the central limit theorem. To bound T1, we apply a modulus of
continuity result on the suprema of empirical processes with respect to function g and log g, where
g is restricted to smooth functions bounded from below (by η0) and above (by η1). As a result,
the bracketing entropy for both function classes G and log G has the same order O(1/δ)γ as given
in (33). Apply Lemma 5.13 of (page 79), to obtain that for δn = n−1/(2+γ), there holds:
T1 = OP(n−1/2∥bgn −g0∥1−γ/2
n) = OP(n−2/(2+γ)),
thanks to part (a) of the theorem. For γ < 2, −2/(2 + γ) < −1/2. So the overall rate is n−1/2.
Algorithmic implementation and simulation examples
In this section, we turn to the more practical issue of implementation, focusing in particular on
estimator E2. When G has a kernel-based structure, we show how, via conversion to its dual form,
the computation of the estimator E2 reduces to the solution of an n-dimensional convex program.
We illustrate the performance of this practical estimator with a variety of simulations.
Algorithms for kernel-based function classes
We develop two versions of estimator E2: in the ﬁrst, we assume that G is a reproducing kernel
Hilbert space (RKHS), whereas in the second, we assume that log G forms an RKHS. In both cases,
we focus on the Hilbert space induced by a Gaussian kernel. This choice is appropriate as it is
suﬃciently rich, but also amenable to eﬃcient optimization procedures .
We begin with some background on reproducing kernel Hilbert spaces; see the books 
for further details. Consider a positive deﬁnite function K mapping the Cartesian product X × X
to the non-negative reals. By Mercer’s theorem, any such kernel function K can be associated
with a feature map Φ : X →H, where H is a Hilbert space with inner product ⟨·, ·⟩. Moreover,
for all x, x′ ∈X, the inner product in this Hilbert space is linked to the kernel via the relation
K(x, x′) = ⟨Φ(x), Φ(x′)⟩.
As a reproducing kernel Hilbert space, any function g ∈H can be
expressed as an inner product g(x) = ⟨w, Φ(x)⟩, where ∥g∥H = ∥w∥H. The kernel used in our
simulations is the Gaussian kernel:
−∥x −y∥2/σ
where ∥· ∥is the Euclidean metric in Rd, and σ > 0 is a parameter for the function class.
Imposing RKHS structure of G
Suppose that the function class G in estimator E2 is the Gaussian RKHS space H, and let the
complexity measure be the Hilbert space norm I(g) = ∥g∥H. With these choices, equation (12a)
w J := min
⟨w, Φ(xi)⟩−1
log⟨w, Φ(yj)⟩+ λn
where the samples {xi} and {yj} are i.i.d. from Q and P, respectively. The log function is extended
to take the value −∞for negative arguments.
Lemma 5. The primal value f ∗has the equivalent dual form:
αiαjK(yi, yj) +
K(xi, xj) −
αjK(xi, yj)
Moreover, the optimal dual solution bα is linked to the optimal primal solution bw via the relation
bαjΦ(yj) −1
Proof. Let ψi(w) := 1
n⟨w, Φ(xi)⟩, ϕj(w) := −1
n log⟨w, Φ(yj)⟩, and Ω(w) = λn
H. We have
w (⟨0, w⟩−J(w)) = −J∗(0)
j(vj) + Ω∗(−
where the last line is due to the inf-convolution theorem . Simple calculations yield:
if v = −αjΦ(yj)
0 if u = 1
nΦ(xi) and + ∞otherwise
Thus, we conclude that f ∗= −minαi
n log nαj)+
j=1 αjΦ(yj)−1
i=1 Φ(xi)∥2
from which the claim follows. The primal-dual relation (42) also follows from these calculations.
For an RKHS based on a Gaussian kernel, the entropy condition (33) holds for any γ > 0 (cf.
Zhou ). Furthermore, condition (32) holds since, via the Cauchy-Schwarz inequality, we have
|g(x)| = |⟨w, Φ(x)⟩| ≤∥w∥H∥Φ(x)∥H ≤I(g)
K(x, x) ≤I(g).
Thus, by Theorem 3(a), we have ∥bw∥H = ∥bgn∥H = OP(∥g0∥H), so the penalty term λn∥bw∥2 vanishes
at the same rate as λn. Thus, we obtain the following estimator for the KL divergence:
n log nbαj) =
n log nbαj.
Imposing RKHS structure on log G
An alternative starting point is to posit that the function class log G has an RKHS structure. In
this case, we consider functions of the form g(x) = exp⟨w, Φ(x)⟩, and use the complexity measure
I(g) = ∥log g∥H = ∥w∥H. Unfortunately, Theorem 3 does not apply directly because condition (32)
no longer holds, but this choice nonetheless seems reasonable and worth investigating from an
empirical viewpoint.
A derivation similar to the previous case yields the following convex program:
e⟨w, Φ(xi)⟩−1
⟨w, Φ(yj)⟩+ λn
αi log(nαi) −αi +
αiΦ(xi) −1
Letting bα be the solution of the above convex program, the KL divergence can be estimated by:
bαi log bαi + bαi log n
Simulation results
In this section, we describe the results of various simulations that demonstrate the practical viability
of the estimators (43) and (44), as well as their convergence behavior. We experimented with our
estimators using various choices of P and Q, including Gaussian, beta, mixture of Gaussians, and
multivariate Gaussian distributions. Here we report results in terms of KL estimation error. For
each of the eight estimation problems described here, we experiment with increasing sample sizes
(the sample size, n, ranges from 100 to 104 or more). Error bars are obtained by replicating each
set-up 250 times.
For all simulations, we report our estimator’s performance using the simple ﬁxed rate λn ∼1/n,
noting that this may be a suboptimal rate. We set the kernel width to be relatively small (σ = .1)
for one-dimensional data, and choose larger σ for higher dimensions. We use M1 and M2 to denote
the estimators (43) and (44), respectively. We compare these methods to algorithm A in Wang et
al , which was shown empirically to be one of the best methods in the literature. This method,
to be denoted by WKV, is based on data-dependent partitioning of the covariate space. Naturally,
the performance of WKV is critically dependent on the amount s of data allocated to each partition;
here we report results with s ∼nγ, where γ = 1/3, 1/2, 2/3.
The four plots in Figure 4.2 present results with univariate distributions.
We see that the
estimator M2 generally exhibits the best convergence rate among the estimators considered. The
WKV estimator performs somewhat less well, and shows sensitivity to the choice of partition size s,
with the ranking of the diﬀerent WKV estimators changing over the experiments. The performance
of estimator M1 is comparable to that of the WKV estimator, although clearly better in the ﬁrst
plot. In Figure 4.2 we present the results with two- and three-dimensional data. Again, estimator
M2 has the best convergence rates in all examples. The M1 estimator does not converge in the
last example, suggesting that the underlying function class exhibits very strong bias.
examples, the WKV estimator again shows sensitivity to the choice of partition size; moreover, its
performance is noticeably degraded in the case of three-dimensional data (the lower two plots).
It is worth noting that as one increases the number of dimensions, histogram-based methods
such as WKV become increasingly diﬃcult to implement, whereas increased dimension has only a
mild eﬀect on the complexity of implementation of our method.
Some extensions
In this section, we discuss some extensions and related estimators, all based on the same basic
variational principle.
Estimation of likelihood ratio functions
Suppose that we are primarily interested in estimating the likelihood ratio function p0/q0, as opposed to the Kullback-Leibler divergence. In this case, we may consider any divergence functional
Dφ(p0, q0), where φ is a convex function on R+, possibly diﬀerent than the logarithm leading to
KL divergence. Again applying Lemma 1, choosing a diﬀerent divergence leads to the following
alternative estimator of the likelihood ratio:
φ∗( bfn) dPn.
The quantity bfn is an estimate of the quantity f0 = ∂φ(q0/p0), whereas bDφ is an estimate of the
divergence Dφ(p0, q0) (of secondary interest for the moment).
10000 20000
Estimate of KL(Beta(1,2),Unif )
M1, σ = .1, λ = 1/n
M2, σ = .1, λ = .1/n
WKV, s = n1/2
WKV, s = n1/3
Estimate of KL(1/2 Nt(0,1)+ 1/2 Nt(1,1),Unif[−5,5])
M1, σ = .1, λ = 1/n
M2, σ = 1, λ = .1/n
WKV, s = n1/3
WKV, s = n1/2
WKV, s = n2/3
Estimate of KL(Nt(0,1),Nt(4,2))
M1, σ = .1, λ = 1/n
M2, σ = .1, λ = .1/n
WKV, s = n1/3
WKV, s = n1/2
WKV, s = n2/3
Estimate of KL(Nt(4,2),Nt(0,1))
M1, σ = 1, λ = .1/n
M2, σ = 1, λ = .1/n
WKV, s = n1/4
WKV, s = n1/3
WKV, s = n1/2
Results of estimating KL divergences for various choices of probability distributions.
In all plots, the X-axis is the number of data points plotted on a log scale, and the Y-axis is the
estimated value. The error bar is obtained by replicating the simulation 250 times. Nt(a, Ik) denotes
a truncated normal distribution of k dimensions with mean (a, . . . , a) and identity covariance matrix.
Estimate of KL(Nt(0,I2),Unif[−3,3]2)
M1, σ = .5, λ = .1/n
M2, σ = .5, λ = .1/n
Estimate of KL(Nt(0,I2),Nt(1,I2))
M1, σ = .5, λ = .1/n
M2, σ = .5, λ = .1/n
Estimate of KL(Nt(0,I3),Unif[−3,3]3)
M1 σ = 1, λ = .1/n1/2
M2, σ = 1, λ = .1/n
M2, σ = 1, λ = .1/n2/3
Estimate of KL(Nt(0,I3),Nt(1,I3))
M1, σ = 1, λ = .1/n
M2, σ = 1, λ = .1/n
Results of estimating KL divergences for various choices of probability distributions.
In all plots, the X-axis is the number of data points plotted on a log scale, and the Y-axis is the
estimated value. The error bar is obtained by replicating the simulation 250 times. Nt(a, Ik) denotes
a truncated normal distribution of k dimensions with mean (a, . . . , a) and identity covariance matrix.
We make the following observations:
• If φ is a diﬀerentiable and strictly convex function, i.e., φ′′ > 0, then the likelihood ratio
function p0/q0 can be recovered by applying the inverse of φ′ to bfn. Thus, we obtain a family
of estimation methods for the likelihood ratio function by simply ranging over choices of φ.
• If (on the other hand) the function φ is chosen to be non-diﬀerentiable, we cannot directly
invert the mapping ∂φ, but we can nonetheless obtain estimators for other interesting objects.
For instance, suppose that φ has the piecewise-linear form
|u −1| if u ≥0
+∞otherwise,
so that Dφ is the variational distance. Noting that ∂φ(u) = sign(u −1) for any u > 0, we
see that the quantity bfn in equation (45) provides an estimate of the thresholded likelihood
Extensions to diﬀerent φ
Let us assume that φ is chosen to be diﬀerentiable and strictly convex, so that we can estimate the
likelihood ratio g0 by applying (φ′)−1 to bfn. Since there are many such φ, it is natural to ask how
the properties of φ aﬀect the quality of the estimate of g0. The analysis provided in the preceding
sections can be adapted to other choices of φ, as we describe here.
In order to describe these extensions, we ﬁrst deﬁne a distance between f0 and f:
Dφ(P, Q) −
fdQ −φ∗(f)dP
Note that this distance is simply the generalization of the quantity d(g0, g) previously deﬁned in
Lem 2). For future reference, we note the equivalence
(φ∗(f) −φ∗(f0))dP −(f −f0)dQ
φ∗(f) −φ∗(f0) −∂φ∗
∂f (f0)(f −f0)
where the ﬁnal line uses the facts that ∂φ∗
∂f (f0) = q0/p0 and φ′(q0/p0) = f0. This expression shows
that dφ is the Bregman divergence deﬁned by the convex function φ∗.
2 In fact, there is strong relationship between variational distance and a threshold function of the likelihood ratio.
Note that the conjugate dual for φ has the form:
−1 if v ≥−1
v if v ∈[−1, 1]
+∞otherwise,
which is related to a hinge loss in the literature of binary classiﬁcation in machine learning.
Indeed, a binary
classiﬁcation problem can be viewed as estimating the threshold function of the likelihood ratio.
See for a
discussion of divergences and surrogate losses from this viewpoint.
Recall that the key ingredient in our earlier analysis was the relation between the empirical
processes deﬁned by equation (25a) and the “distance” d(g0, g) (see Lemma 2). Similarly, the key
technical ingredient in the extension to general φ involves relating the quantity
(φ∗(f) −φ∗(f0))d(Pn −P) −
(f −f0)d(Qn −Q)
to the distance dφ(f0, f) deﬁned in equation (47). In particular, we can state the following analog
of Lemma 2 and Lemma 3:
Lemma 6. Let bfn be the estimate of f0 obtained by solving the problem (45). Then
dφ(f0, bfn) ≤vφ
Under suitable technical conditions, we have vφ
−→0, so that Lemma 6 implies that bfn
is a consistent estimator for f0 in the sense of dφ. This lemma also provides the technical means
to derive convergence rates in the same manner as in the previous sections. Note that dφ(f0, f) is
usually not a proper metric. To apply standard results from empirical process theory, the trick is
that one can replace dφ by a lower bound which is a proper metric (such as L2 or Hellinger metric).
In the case of KL divergence, we have seen that this lower bound is the Hellinger distance (via
Lemma 2(i)).
Let us illustrate this idea by stating a result about likelihood ratio estimation in terms of the
χ-square divergence, which is deﬁned by
Note that this divergence is an f-divergence with φ(u) = 1/u; a short calculation (see Appendix F)
shows that the associated “distance” dχ is given by dχ(g, g0) =
(g −g0)2dQ, which is simply the
L2(Q) metric. With this set-up, the estimator now has the following “least square” form:
bgn := argmaxg∈G
The following theorem is an analog of Theorem 2 (with an almost identical proof):
Theorem 4. Assume that for some constant 0 < γ < 2,
δ (G, L2(Q))
and moreover that condition (27a) holds. Then the estimator bgn obtained from the χ-square divergence is consistent with rate dχ(g0, bgn) = OP(n−2/(γ+2)).
Remark: Comparing with Theorem 2, we see that the conditions of Theorem 4 are weaker. Indeed,
the L2(Q) metric is dominated by the Hellinger metric, so that imposing bounds on L2(Q)-metric
and its induced entropy are milder conditions.
Estimation of the divergence functional Dφ
Suppose that we are primarily interested in estimating the divergence functional Dφ, given that we
have already obtained an optimal estimator bgn of the likelihood ratio function g0 = p0/g0 (such as
the one deﬁned by (9a) or (12a), or more generally (45)). We have demonstrated that Dφ can be
estimated by (9b) and (12b), or more generally by (46). Note that Dφ can be viewed as an integral
of the likelihood ratio under the distribution Q. Indeed, we can write
Dφ(P, Q) =
(p0/q0)φ(q0/p0) dQ =
g0φ(1/g0) dQ.
Although Dφ is an integral functional of g0 = p0/q0, an interesting feature here is that the integration is with respect to unknown Q. In this section, we show that estimators such as (9b) and (12b)
for the KL divergence can be viewed as a ﬁrst-order Taylor expansion of the integral functional
around the estimate bgn of the likelihood ratio. This discussion is motivated by a line of work on
the estimation of integral functional of a single density function (cf. ), and also leads to an
open question.
Suppose that φ : R+ →R is a convex function diﬀerentiable up to third order, G is a smooth
function class bounded from both above and below as in Example 1 (with smoothness parameter α).
Suppose that bgn is an estimator of g0 (such as the one deﬁned by (45)), and that ∥bgn −g0∥L2(Q) =
OP (n−α/(2α+d)). Using a Taylor expansion around bgn, we obtain:
bgnφ(1/bgn) + (g −bgn)(φ(1/bgn) −φ′(1/bgn)/bgn) + (g −bgn)2φ′′(1/bgn)/bg3
O((g −bgn)3)
φ′(1/bgn) + φ′′(1/bgn)/bgn + g(φ(1/bgn) −φ′(1/bgn)/bgn −2φ′′(1/bgn)/bg2
g2φ′′(1/bgn)/bg3
n + O((g −bgn)3).
We arrive at
Z  φ′(1/bgn) + φ′′(1/bgn)/bgn
Z  φ(1/bgn) −φ′(1/bgn)/bgn −2φ′′(1/bgn)/bg2
0/q0 φ′′(1/bgn)/bg3
n dµ + O(∥g0 −bgn∥3
In the above expression, the ﬁrst two integrals can be estimated from two n-samples of empirical
data drawn from P and Q. Because of the boundedness assumption, these estimations have at most
OP (n−1/2) error. The error of our Taylor approximation is O(∥g0 −bgn∥3
3) = OP (n−3α/(2α+d)). This
rate is less than O(n−1/2) for α ≥d/4. Thus when α ≥d/4, the optimal rate of convergence for estimating Dφ hinges on the convergence rate for estimating the integral of the form
0/q0ψ dµ. This
is interesting because we have reduced the problem of estimating any f-divergence to a particular
integral of two densities
0/q0ψ dµ, where ψ is a known function.
Let us return to the case of KL divergence, i.e., φ(u) = −log u. If we use Taylor approximation
up to ﬁrst order, the estimator has the following form:
(φ(1/bgn) −φ′(1/bgn)/bgn) dPn +
φ′(1/bgn) dQn
log bgn + 1dPn −bgndQn,
which has exactly the same form as our original estimator (9b), except that here bgn can be any
(optimal) estimator of the likelihood ratio.
Note that we have shown the optimal convergence
rate of n−1/2 for the KL divergence estimator, given α > d/2 (so that γ = d/α < 2). Questions
regarding the estimator and its analysis for the case α ≤d/2 remain unexplored. In particular,
for the regime α ∈[d/4, d/2], the optimal rate of n−1/2 for estimating KL divergence (and Dφ in
general) is certainly achievable by using Taylor expansion up to second order, assuming that a
separate method exists to achieve the optimal rate n−1/2 for the integral
Conclusions
We have developed and analyzed M-estimation methods for both the likelihood ratio and fdivergence functionals of two unknown multivariate probability distributions by exploiting a variational characterization of f-divergence functionals. The methods are shown to be amenable to
eﬃcient computational algorithms for optimization in high-dimensional function spaces. We have
also described our method in the general context of estimating integral functionals of the likelihood
ratio of two unknown densities, and discussed directions for future work suggested by our results.
Acknowledgements
This work was partially supported by NSF grants DMS-0605165 and CCF-0545862 (MJW) and by
NSF grant 0509559 (MIJ). The ﬁrst author would like to acknowledge Bharath Sriperumbudur for
helpful discussions.
Proof of Lemma 2
(i) Note that for x > 0, 1
2 log x ≤√x −1. Thus,
(g1/2g−1/2
−1) dP. As a result,
(g −g0) dQ −2
(g1/2g−1/2
(g −g0) dQ −2
(g1/2 −g1/2
(ii) By our estimation procedure, we have
log bgndPn ≤
log g0dPn. It follows
d(g0, bgn)
(bgn −g0)dQ −
(log bgn −log g0)dP
(bgn −g0)d(Q −Qn) −
(log bgn −log g0)d(P −Pn)
d(Pn −P) −
(g −g0)d(Qn −Q).
Proof of Lemma 3
The ﬁrst inequality is straightforward. We shall focus on the second. By the deﬁnition of our
estimator, we have:
log bgndPn ≤
log g0dPn.
Both sides are convex functionals of g.
Use the following fact: If F is a convex function and
F(u) ≤F(v), then F((u + v)/2) ≤F(v). We obtain:
Z bgn + g0
log bgn + g0
log g0dPn.
Rearranging,
d(Qn −Q) −
log bgn + g0
d(Pn −P) ≤
log bgn + g0
= −d(g0, g0 + bgn
Q(g0, g0 + bgn
where the last inequality is an application of Lemma 2.
Proof of Lemma 4
Deﬁne dl(g0, g) =
(g −g0)dQ −log g
g0dP. Note that for x > 0, 1
2 log x ≤√x −1. Thus,
(g1/2g−1/2
As a result, for any g, dl is related to hQ as follows:
(g −g0) dQ −2
(g1/2g−1/2
(g −g0) dQ −2
(g1/2 −g1/2
By the deﬁnition (12a) of our estimator, we have:
log bgndPn + λn
2 I2(bgn) ≤
log g0dPn + λn
Both sides are convex functionals of g. By Jensen’s inequality, if F is a convex function, then
F((u + v)/2) −F(v) ≤(F(u) −F(v))/2. We obtain:
Z bgn + g0
log bgn + g0
4 I2(bgn) ≤
log g0dPn + λn
Rearranging,
d(Qn −Q) −
log bgn+g0
2g0 d(Pn −P) + λn
4 I2(bgn) ≤
log bgn + g0
4 I2(g0) = −dl(g0, g0 + bgn
Q(g0, g0 + bgn
4 I2(g0) ≤−1
Q(g0, bgn) + λn
where the last inequality is a standard result for the (generalized) Hellinger distance
(cf. ).
Proof of Theorem 2
(a) One of the empirical processes on the right-hand side of Lemma 3 involves function class
F := log G+g0
2g0 . For each g ∈G, let fg := log g+g0
2g0 . We endow F with a “norm,” namely, Bernstein
distance. This is deﬁned as follows: for a constant K > 0,
ρK(f)2 := 2K2
(e|f|/K −1 −|f|/K)dP.
The Bernstein distance is related to the Hellinger distance in several crucial ways (see, e.g., ,
• ρ1(fg) ≤4hQ(g0, g+g0
• The bracketing entropy based on Bernstein distance is also related to the bracketing entropy
based Hellinger distance (i.e., which is the L2 norm for the square root function):
2δ(F, ρ1) ≤HB
δ ( ¯G, L2(Q)),
where ¯G := {((g + g0)/2)1/2, g ∈G} and ¯g := (g + g0)/2.
By Lemma 3, for any δ > 0, with respect to P measure:
P(hQ(g0, bgn) > δ) ≤P(hQ(g0, (bgn + g0)/2) > δ/4)
g∈G, hQ(g0,¯g)>δ/4
(¯g −g0)d(Qn −Q) +
fg d(Pn −P) −2h2
Q(g0, ¯g) ≥0
g∈G, hQ(g0,¯g)>δ/4
(¯g −g0)d(Qn −Q) −h2
Q(g0, ¯g) ≥0
g∈G, hQ(g0,¯g)>δ/4
fg d(Pn −P) −h2
Q(g0, ¯g) ≥0
We need to upper bound the two quantities A and B on the right-hand side of this equation. These
can be handled in a similar manner. Since HB
δ ( ¯G, L2(Q)) < ∞the diameter of ¯G is ﬁnite. Let
S be the minimum s such that 2s+1δ/4 exceeds that diameter. We apply the so-called peeling
device: Decompose ¯G into layers of Hellinger balls around g0 and then apply the union bound on
the probability of excess. For each layer, one can now apply the modulus of continuity of suprema
of an empirical process.
g∈G, hQ(g0,¯g)≤2s+1δ/4
fg d(Pn −P) ≥22s(δ/4)2
Note that if hQ(g0, ¯g) ≤2s+1δ/4 then ρ1(fg) ≤2s+1δ. Note that for any s = 1, . . . , S, the bracketing
entropy integral can be bounded as:
ǫ (F ∩{hQ(g0, ¯g) ≤2s+1δ/4}, ρ1)1/2 dǫ
2( ¯G ∩{hQ(g0, ¯g) ≤2s+1δ/4}, L2(Q))1/2 dǫ
C8(2s+1δ)1−γ ¯
where C8, C9 are constants independent of s. Now apply Theorem 6 (see Appendix G), where
K = 1, R = 2s+1δ, a = C1
√nR2/K = C1
√n22(s+1)δ2. We need
a ≥C0C8(2s+1δ)1−γ ¯
G/2 > C0R.
This is satisﬁed if δ = n−1/(γ ¯
G+2) and C1 = C0C8, where C8 is suﬃciently large (independently of
s). Finally, C2
0 ≥C2(C1 + 1) = C2(C0C8 + 1) if C0 := 2C2C8 ∨2C, where C is some universal
constant in Theorem 6. Applying this theorem, we obtain:
1n22(s+1)δ2
C2(C1 + 1)
for some universal constant c. A similar bound can be obtained for A, with respect to Q measure and
with δ = n−1/(γ ¯
G+2). Since p0/q0 is bounded from above, this also implies a probability statement
with respect to P. Thus, hQ(g0, bgn) is bounded in P-probability by n−1/(γ ¯
(b) The proof is similar to Theorem 3(b) and is omitted.
Comparison of the rate in Lemma 2 to the minimax rate
Recall that the minimax rate is deﬁned as
EP [hQ(g0, bgn)],
where the supremum is taken over all pairs (P, Q) such that g0 ∈G. Note that rn ≥infbgn∈G supP Ehµ(g0, bgn),
where we have ﬁxed Q = µ, the Lebesgue measure on X. We can reduce this bound to the minimax
lower bound for a nonparametric density estimation problem . This reduction is not entirely
straightforward, however, because the space G ranges over smooth functions that need not be valid
probability densities. Therefore, an easy-to-use minimax lower bound such as that of is not
immediately applicable. Nonetheless, we can still apply the hypercube argument and the Assouad
lemma to obtain the right minimax rate. See §24.3 of van der Vaart for a proof for the case of
one dimension. This proof goes through for general d ≥1.
Some calculations for Theorem 4
Note that the conjugate dual of φ(u) = 1/u takes the form
if v < 0, and
otherwise.
Consequently, we can restrict F to the subset for which f < 0 for any f ∈F. Let g := √−f and
−F. G is a function class of positive functions. We have g0 := √−f0 =
−φ′(q0/p0) = p0/q0.
Deﬁne bgn :=
−bfn. We also replace notation dφ(f0, f) by dφ(g0, g). For our choice of φ, we have:
dχ(f0, f) =
−f0)dP −(f −f0)dQ
(g0 −g)(2p0/q0 −g0 −g)dQ
(g −g0)2dQ,
as claimed. Moreover, we have
n(F) = sup
0)d(Qn −Q) −
(g −g0)d(Pn −P)
Results from empirical process theory
For completeness, we state here two standard results from empirical process theory that are needed
in the paper. These results are versions of Theorems 3.7 and 5.11 from van de Geer , respectively:
Theorem 5. Let G(x) = supg∈G |g(x)| be the envelope function for a function G. Assume that
GdP < ∞, and suppose moreover that for any δ > 0, 1
nHδ(G, L1(Pn))
−→0. Then supg∈G
Theorem 6. Suppose that the function class G satisﬁes supg∈G ρK(g) ≤R for some constants K
and R. Given a > 0, suppose that for some constants C and C1, there holds
C2(C1 + 1)
u (G, ρK)1/2du ∨R
Then the empirical process is bounded as
C2(C1 + 1)R2