HAL Id: hal-02108863
 
Submitted on 24 Mar 2021
HAL is a multi-disciplinary open access
archive for the deposit and dissemination of scientific research documents, whether they are published or not.
The documents may come from
teaching and research institutions in France or
abroad, or from public or private research centers.
L’archive ouverte pluridisciplinaire HAL, est
destinée au dépôt et à la diffusion de documents
scientifiques de niveau recherche, publiés ou non,
émanant des établissements d’enseignement et de
recherche français ou étrangers, des laboratoires
publics ou privés.
A Comprehensive Assessment of the Short-Term
Uncertainty of Grid-Connected PV Systems
Enrica Scolari, Lorenzo Reyes-Chamorro, Fabrizio Sossan, Mario Paolone
To cite this version:
Enrica Scolari, Lorenzo Reyes-Chamorro, Fabrizio Sossan, Mario Paolone. A Comprehensive Assessment of the Short-Term Uncertainty of Grid-Connected PV Systems. IEEE Transactions on Sustainable Energy , 2018, 9 (3), pp.1458-1467. ￿10.1109/TSTE.2018.2789937￿. ￿hal-02108863￿
A Comprehensive Assessment of the Short-Term
Uncertainty of Grid-Connected PV Systems
E. Scolari, Student Member, IEEE, L. Reyes-Chamorro, Member, IEEE, F. Sossan, Member, IEEE,
M. Paolone, Senior Member, IEEE
Abstract—One of the key aspects enabling the bulk integration
of photovoltaic (PV) resources into the power grid is the shortterm prediction of the maximum available power (from 100 ms to
5 minutes), and the quantiﬁcation of the associated uncertainties.
This is beneﬁcial for the deﬁnition of robust control strategies
able to account for the stochastic nature of this energy resource.
We propose and validate a comprehensive method to assess the
overall PV power uncertainties, even at operating conditions
different from the maximum power point (MPP), i.e., to consider
when power curtailment strategies are adopted on a controllable
PV plant. The proposed gray-box modeling includes physical
and data-driven sub-models that rely on measurements of the
PV currents, voltages, and the module temperature, information
normally available to the PV plant operator. Furthermore,
we identify which sub-model is the most critical in terms of
uncertainty, for different forecast horizons. Experimental results
analyze the ability of the method to guarantee the target coverage
probability while accounting for the uncertain nature of the PV
resource. We show how modelling and forecasting information
can be used to express the PV plant behaviour to a grid controller
responsible for the safe operation of a microgrid.
Index Terms—Photovoltaic modeling, gray-box modeling, solar
forecast, uncertainty assessment, microgrid.
The increasing proportion of distributed generation (DG)
in the power generation mix requires redeﬁning conventional
practices to mitigate the impact of stochastic resources like
photovoltaic (PV) systems . The main issues are related to
the operational limits of the local grid, in terms of quality
of supply and line congestions – . In particular, the
PV power output at low level of aggregation can contain
variations on short time scales (lower than 1 second) due to
high-frequency irradiance ﬂuctuations . These short-term
dynamics can cause violations of the quality requirements
for electrical networks like voltage ﬂickers . To respond
to these issues, PV inverters are generally used for droopbased voltage regulation by controlling the reactive power
injections . However, since power distribution networks are
characterized by lines parameters with large R/X (ratio of
the components of their longitudinal impedances), there is
generally the need of coupling the reactive power control with
active power curtailment (APC) strategies – . The main
concern related to simple APC strategies is that the active
power curtailment might not be the most favorable solution
if, for example, other resources (e.g. storage systems) are
available in the grid. In this respect, there is an increasing
attention in the literature towards new control approaches
that are able to explicitly account for the aforementioned
This research received funding from the Swiss Competence Center for
Energy Research (FURIES) and by the SNSF NRP70 Energy Turnaround.
technical issues while intelligently exploiting the ﬂexibility
of all the available resources , . For the case of
microgrids, their limited geographical extension joined with
the capability to function autonomously determine the need for
sub-second time-scale control. In this context, several control
strategies are presented in the literature . In particular,
two main approaches are followed i) distributed/decentralized
and (ii) fully centralized. In the decentralized case, improved
droop strategies that account for the internal state of the
resources are proposed as a natural extension of consolidated
control philosophies, (e.g. , ). Alternatively, droop-free
methods based on multi-agents systems (MAS) are proposed,
where agents exchange their objectives and uncertainties to
reach a consensus and minimize a given shared cost function
(e.g. , ). In the case of centralized approaches, a
central controller is responsible for the solution of an optimal
dispatch problem constrained by the grid operation limits.
MAS are usually proposed also in the centralized case, ,
where a central agent receives messages from the followers,
solves an overall problem, and sends the messages back to
the followers. The knowledge of the PV short-term behavior
and its uncertainties becomes a key factor to ensure the
robustness of the mentioned control strategies, . In this
work, we propose a gray-box method to assess the overall
PV plant ﬂexibility and associated uncertainties at different
forecast horizons, from 100 ms to 5 min. The contributions
of the work are the following. First, we describe how to
accurately predict the one-step-ahead AC maximum available
power, integrating a model for the PV modules, a model for
the converter, and a probabilistic short-term forecasting tool.
The sub-models are selected to be of easy reproducibility, and
the methodology needs few inputs: i) information from the
PV module datasheet, ii) real-time measurements of the PV
plant voltages and currents, and iii) a temperature sensor. The
available literature generally focuses on the individual submodel accuracy, e.g. , , while we here evaluate the
overall chain that allows obtaining the AC maximum power.
For different forecast horizons and, for the ﬁrst time, for
different levels of curtailed energy, we identify which submodel is the most critical. The validation is made possible by a
dedicated experimental setup that relies on a fully controllable
converter, , which can track an external power reference of
active and reactive power. Second, the uncertainty of the PV
converter in tracking an external setpoint is accounted. Indeed,
due to the internal characteristic of the converter (e.g. control
loop), the implemented power injection can differ from the
request. Finally, we show how the proposed methodology can
be used to advertise the PV plant future behaviour to a central
grid controller. This is relevant to allow model predictive
control approaches to intelligently exploit the PV ﬂexibility,
aiding PV integration into the grid.
The work is structured as follows: Section I deﬁnes the
problem, Section II describes the experimental setup used
for the validation, Section III discusses the different blocks
used to describe the PV behaviour and the related literature,
Section IV shows the results of the uncertainty assessment.
Finally, Section V shows how to design a PV agent, Section VI
presents a further discussion on the methods, and Section VII
draws the main conclusions.
I. PROBLEM DEFINITION
We consider a generic PV system (Fig. 1), with the following characteristics (i) it is always connected to the grid
as a grid-feeding converter , (ii) it allows to track an
external active/reactive power setpoint u = (P ⇤, Q⇤) from a
Grid Controller (GC). The PV system has an inherent ﬂexibility
to modify its power operating conditions, namely the capacity
of curtailing the generation of this resource, along with the
possibility of controlling its reactive-power injection.
Fig. 1. Problem context. We consider a generic PV plant connected to the
grid. The resource is equipped with an agent that can communicate with a
generic grid controller. The dashed lines delineate exogeneous elements to the
In order to allow the GC to exploit this ﬂexibility, a
dedicated agent is introduced. It continuously receives an
updated state ˆx from the PV system (e.g., the measured power
value) and sends to the GC a feedback X that represents the
expected one-step-ahead operational ﬂexibility and uncertainty
(see Section V). It is important to note that, since the converter
can track external power setpoints, the measured AC power
does not necessarily correspond to the maximum available one,
and may not be representative of the production potential of the
plant, that mostly depends on the external weather conditions
w (e.g., solar irradiance). Therefore, a physical model of the
PV system is needed to reconstruct at each time-step the AC
maximum available power, as detailed in Section III. These
reconstructed power values are then used to train a time-seriesbased forecasting tool needed to predict the one-step-ahead
AC maximum power. The uncertainty related to the delivered
prediction is explained by both the stochasticity of the forecast
and the PV/converter modeling errors. Furthermore, due to the
converter internal operational constraints e, the external power
reference u = (P ⇤, Q⇤) differs from the actual implemented
power injection y = (P, Q), this representing a further source
of uncertainty. Consequently, a comprehensive uncertainty assessment is needed to account for these aspects: i) uncertainty
on the one-step-ahead maximum available power computation,
and ii) uncertainty on the setpoint tracking.
II. EXPERIMENTAL SETUP
We anticipate in this section the description of the experimental setup to introduce information about the observed state
variables of the system we target to control. The PV system
under test is detailed in Fig. 2. The power stage includes
a PV-Side Converter (PVSC), that controls the power ﬂow
injected by the PV panels into the common DC-bus, and a
Grid-Side Converter (GSC) responsible of controlling active
and reactive power ﬂows injected into the grid. We assume
to have access to the measurements of the DC voltage, DC
current, and average cell temperature of the PV array (v, i, ✓),
and to the voltages and currents phasors at the fundamental
frequency components from the three-phase AC grid ( ¯V , ¯I)1.
The global irradiance on the PV plant G could be measured
by a sensor (e.g. pyranometer), but in this paper, it is inferred
from the PV-array measurements as in , and detailed in
Section III.
Fig. 2. Detailed view of the PV system.
The PV array consists in a 13 kWp rooftop PV installation
with 51 polycrystalline modules. The agent (Fig. 1) is implemented in a NI CompactRIO 9068 and communicates with the
converter through a CAN bus interface. Currents and voltage
measurements are acquired with a 16 bit ADC (NI-9215).
Currents are measured with LEM LF 205-S transducers with
an accuracy of ±0.2%. Voltages are measured with LEM
CV 3-100 transducers with an accuracy of ±0.5%. The cell
temperature is measured using a TSic303, a sensor with
±0.5 ◦C accuracy, installed on the rear surface of one panel
and acquired by a NI sbRIO 9625 with a 16 bit ADC. All
measurements are synchronized and sampled at 20 kHz. Since
our analysis includes curtailment periods, a second equivalent
PV system is used as a reference installation to obtain the
maximum PV power output when the test plant is operated
in non-MPPT mode.2. The equivalent behaviour of the two
converters is experimentally compared by running both of
1These electrical quantities are commonly available in commercial PV
converters, while the PV-array temperature can be easily measured.
2This reference PV system is needed only to assess the performance of the
proposed method. The considered models are based on measurements from
the tested PV system and, as later explained in the text, the presence of a
reference system is not necessary to the ﬁnal user.
them in MPPT mode. The test is performed on an 11 days
period characterized by mixed weather conditions (3 clearsky days, 2 overcast days, and 6 partly-cloudy days). In
these conditions, the average absolute difference between the
delivered AC active power values is less than 100 W. Therefore
we can assume that the behaviours of the two systems are
comparable.
III. METHODS
In this section we propose a method that, regardless of the
PV system operating point, is able to i) provide a probabilistic
forecast of the one-step-ahead maximum available power, and
ii) determine the uncertainty on tracking a power setpoint. For
short-term horizons (from sub-seconds to minutes), the ﬁrst
goal can be achieved by using time-series based forecasting
methods, . In particular, thanks to the increasing availability of electrical measurements, the use of direct forecast
methods (that directly learn from historical power values) has
recently gained interest, e.g. , . However, training
the forecasting tool with raw power measurements might
lead to inaccurate results when past production measurements
are altered by the adoption of APC strategies and thus the
measured power is not the maximum available. Fig. 3 depicts
a situation where a PV plant operates in APC regime (star).
The production at this working point is not representative
of the true irradiance potential, which corresponds instead
to the maximum power point (dot). To solve this problem,
Voltage [V]
DC Power [W]
Example of measured power (star) and maximum power (dot) shown
for one PV module.
we ﬁrst apply a model-based estimator (with parameters Pp)
to reconstruct the DC maximum available power, ˜Pdc, from
measurements of the DC voltage v, current i, and module
temperature ✓(Section III-A1). Then, we use a model of the
converter (with parameters Pc) to estimate the AC maximum
power, ˜P (Section III-A2). The procedure is shown in Fig. 4.
Historical values of ˜P are then used to train a forecasting
tool. The procedure, described in , allows to improve the
performance of time-series-based forecasting tools compared
to the direct forecast, if the system can operate in non-
MPPT, by ensuring that the forecasting models are trained
with data that are representative of real dynamics of the
irradiance/maximum available power. In what follows we
detail the overall methodology necessary to predict the PV
plant power capability and the related uncertainty. The adopted
models, used on-line, are presented in Section III-A, while
Section III-B describes how to off-line assess their parameters.
Fig. 4. Maximum Available Power Estimator. The AC maximum power value
can be reconstructed using the PV and converter model. The inputs are the
measured DC voltage and current (v, i), and the cell temperature ✓.
Uncertainty
Forecasting
Fig. 5. On-line modelling chain.
The on-line process, depicted in Fig. 5, is as follows. At
each time-step t, the measurements vt, it, ✓t are used as inputs
to the maximum available power estimator in Fig. 4 to get
˜Pt. This value is used as input to i) a forecasting tool (with
parameters Pf) to deliver the upper and lower bounds of the
one-step-ahead prediction interval (P "↵
t+1,f, P #↵
t+1,f) and ii) a
modeling error block (with parameters Pm) to compute the
upper and lower bounds accounting for the PV and converter
model uncertainty (P "↵
t+1,m, P #↵
t+1,m). A conservative approach
to compute the global uncertainty associated to the one-stepahead prediction is to consider the extreme bounds between
the model bounds and the forecasting intervals3:
t+1 = max(P "↵
t+1,f, P "↵
t+1 = min(P #↵
t+1,f, P #↵
These global bounds (P "↵
t+1) are then used as an input for
a block that models the ability of the power converter to track
a power setpoint (with parameters Ps). This block outputs
a set-valued function, B↵
t (ut+1), which represents the overall
uncertainty of tracking a power setpoint ut+1. Thus, B↵
include all the uncertainties related to the PV plant future
operation. We next describe the different blocks involved in
the methodology: PV model, converter model, forecasting
tool, modeling error, and setpoint uncertainty model. We
discuss the off-line assessment of the models parameters P
in Section III-B.
1) PV Model:
Equivalent circuit models are usually
adopted to represent the electrical output of a PV cell, .
We select here the ﬁve-parameter model proposed in ,
extended to an entire PV array. This is the most used model
for PV simulation, thanks to its simplicity and accuracy, since
it only needs information from the PV module datasheet.
The model for a single cell is shown in Fig. 6. We denote
Rs, Rp the series and shunt resistances and Ip, iD the light
and saturation currents respectively. We indicate with ⇤the irradiance and temperature at Standard Test Conditions (STC)4.
We solve the inversed diode equation to estimate the irradiance
3A detailed analysis of these uncertainties is reported in Section IV-B.
4Temperature ✓⇤= 25 ◦C and irradiance G⇤= 1000 W m−2.
Fig. 6. The ﬁve-parameter circuital model of a PV cell, .
Gt(vt, it, ✓t):5
it + iDnp(✓t/✓⇤)3 exp
g/k✓⇤−Egt/k✓t
q vt+Rsit(ns/np)
np (Ip + ↵ISC(✓t −✓⇤)) −vt+Rsit(ns/np)
where np and ns are the number of cells in parallel and series
in a PV module, ↵ISC the short circuit current temperature
coefﬁcient, k the Boltzmann constant, q the electron charge,
g the material band-gap energy at ✓⇤, and nr the diode
ideality factor. Egt is calculated from E⇤
g and ✓t as described in . The parameters of the module model are thus
Pp = {Rs, Rp, Ip, iD, nr, ns, np, E⇤
g, ↵ISC}. The estimated
irradiance ˜
Gt is then used, together with the cell temperature
✓t, to compute the maximum DC power. In particular, solving
the ﬁve-parameter model allows to obtain the i-v curve of the
PV array at the conditions deﬁned by the couple ( ˜G,✓). The DC
maximum power is simply calculated as the maximum of the
product of the i-v curve coordinates. The real-time calculation
of the DC maximum power takes less than 15 ms on a personal
computer (Intel Core i7-6600 2.6 GHz, with a 12 GB RAM).
This is a key aspect if considering the high reporting rate of
predictions for microgrid applications.
2) Converter Model: The converter model allows computing the AC power from the DC power and the DC voltage. Two
main models are available in the literature, and . Both
require ﬁtting the parameters using datasheet and operational
data. In our case, ﬁtting a simple quadratic model led to a
better accuracy:
˜Pt = β0 + β1 ˜Pdc,t + β2vt + β11 ˜P 2
dc,t + β12 ˜Pdc,tvt + β22v2
˜Pt is the AC power (response variable),
˜Pdc,t the
DC power, vt the DC voltage (the predictors), and Pc =
{β0, β1, β2, β11, β12, β22} are the model coefﬁcients.
3) Forecasting Tool: To compute short-term prediction intervals (PIs), we adopt the method proposed in directly
applied to the AC power. It consists in clustering historical
differentiated maximum power estimations using the k-means
clustering algorithm, . The clustering, performed off-line,
is based on two inﬂuential variables: i) the average power and
ii) the power variability, calculated on a rolling time window
considering the last three AC maximum power estimations. At
each time-step, when a new AC maximum power estimation
˜P is available, the inﬂuential variables are computed on-line.
The Euclidean distance between the centroids and the actual
inﬂuential variables is then used as the similarity criterion to
identify the representative cluster. Then, we use the upper
5Refer to , to see how Eq. (3) is inferred.
and lower quantiles, Pf = {q"↵
f }, extracted from the
representative cluster, to calculate the prediction bounds, at
a given conﬁdence level ↵. In particular, we sum the quantiles
to the estimated AC maximum power:
t+1,f = ˜Pt + q"↵
t+1,f = ˜Pt + q#↵
It is worth noting that the k-means clustering of the training
is computed off-line on historical data (see Section III-B) and
the on-line computation of the PI takes less than 0.5 ms on a
personal computer.
4) Modeling Error:
The model-based strategy to reconstruct ˜P ensure that the forecasting tool learns from training data that are representative of the maximum power, even
when the system is not operating in MPPT mode. However,
the obtained prediction interval does not account for the error
associated to the PV/converter models, needed in the chain to
reconstruct the maximum available power. For this reason, a
set of AC measurements, { ¯V , ¯I}, see Fig. 2, is used to account
for the modeling error deﬁned at each time step as:
et = ˜Pt −Pt( ¯Vt, ¯It), ,
where ˜Pt is the AC maximum power estimation and Pt the
ground truth value, computed from ( ¯Vt, ¯It). This error captures
all what is not captured by the forecasting model. We consider
the modeling error distribution on a training set, and we extract
the upper and lower quantiles of the set, Pm = {q"↵
corresponding to the target conﬁdence level ↵. The uncertainty
bounds associated to the model are deﬁned as:
t+1,m = ˜Pt + q"↵
t+1,m = ˜Pt + q#↵
5) Setpoint Uncertainty Model: The uncertainty on tracking
a power setpoint depends on the internal control law of the
converter. In particular, for a given setpoint u, we have a set
of possible AC active and reactive power injections (P, Q),
for which we can compute the distances dP(u) = P ⇤−P(u)
and dQ(u) = Q⇤−Q(u). We deﬁne
P (u), δ#↵
Q (u), δ#↵
as the upper and lower quantiles extracted
from the dP(u) and dQ(u) distributions, respectively. For a
given setpoint ut = (P ⇤
t ), the implemented power lays
in a rectangular set with a certain conﬁdence level ↵, i.e.
yt 2 R↵(ut) where:
R↵(ut) ={(P, Q) 2 IR2|
P (ut) P ⇤
Q (ut) Q⇤
Q } contains all the extracted quantiles
computed off-line for different values of u.
The sets of parameters Pp, Pc, Pf, Pm, Ps, are computed
during an off-line phase, as described in the following.
B. Models Parameters: Off-line Assessment
The parameters of the module model Pp can be computed
off-line using the procedure in that only needs the module
datasheet as input information. The converter model coefﬁcients deﬁning Pc are obtained by ﬁtting a regression model
on a set of data obtained by operating the converter from zero
to the maximum rated power. To train the forecasting tool (and
compute Pf) we consider a set of N historical measurements
{v, i, ✓} and use the maximum available power estimator,
in Section III-A1, to get ˜P for each set of measurements.
The obtained N historical estimations of ˜P are used to build
the clusters of the selected probabilistic forecasting tool, see
Section III-A3. The clustered data are used to extract the
quantiles that deﬁne Pf. The quantiles of the modeling error
distribution are used to deﬁne Pm. In practice, for period of
length M, we let the PV converter work in MPPT, and thus
the maximum available power can be directly measured. The
training set used to deﬁne the error should cover different irradiance and temperature conditions, for example by selecting
few entire days characterized by different weather conditions.
Finally, the setpoint uncertainty is assessed by requesting
speciﬁc power setpoints to the converter, by sweeping the
whole PQ capability set. We then extract the quantiles from
the distributions of the observed distances
dP(u), dQ(u)
for all the requested setpoints u. This allows to deﬁne Ps.
IV. RESULTS
A. PV and Converter Models Performance
In the case of the PV model, the method can reconstruct
the theoretical maximum power output with a normalized root
mean squared error (nRMSE) of 0.5-6%, see . For the
converter model, the values of the coefﬁcients from Eq. (4)
are shown in Table I. Fig. 7 compares the estimations from
CONVERTER MODEL COEFFICIENTS
-2.89 ·10−6
the ﬁtting to the measured AC power values for an entire day
of measurements, presenting an error of 1.6% (nRMSE).
DC Power [W]
AC Power [W]
Measurements
Estimations
The AC power, estimated using the converter model described in
Section III-A2, is compared with the measured AC power.
B. Maximum Available Power Uncertainty Assessment
In this section, we quantify the prediction uncertainty of the
AC maximum power considering different forecast horizons
(100 ms, 1 s, 1 min and 5 min), and different levels of curtailed
energy (0%, 2% and 30%). The latter is computed as the
percentage of curtailed energy over the maximum available in
the testing period. The metrics are adapted from . The ﬁrst
metric is the bound Coverage Probability (CP) which counts
the number of times the realization falls inside the PI for a
given conﬁdence level ↵:
t+1|t Pt+1 P "↵
otherwise.
where L is the total number testing instances.
Then, the interval normalized Averaged Width (AW):
t+1|t −P #↵
where Pmax = 13 kW is the rated power of the converter.
Bounds are considered accurate when CP ≥↵and the AW
is low. The bounds are computed: i) as in Eqs. (1)-(2), i.e.,
considering the worst case between modeling and forecast uncertainty (Global), ii) considering only the forecast uncertainty
(Forecast), and iii) considering only the modeling uncertainty
(Model). Results are summarized in Table II and Table III for a
target conﬁdence level of 95%. The length of the training set
and the number of clusters for the k-mean-based algorithm
are selected accordingly to . In particular, we consider
a training set of 4 days for the 100 ms and 1 s horizons,
and of 10 days for the 1 and 5 min horizons. The testing
set is of 2 days. The number of clusters is 100, 25, 15, and
5 for 100 ms, 1 s, 1 min, and 5 min, respectively. In our
analysis, the same training set is used to extract the quantiles
for the modeling error. From Table II we observe that only
the global prediction chain is able to deliver bounds with
high coverage (CP is similar to the target conﬁdence level).
At short-term horizons (below the minute scale), the forecast
uncertainty is low (Table III), and accounting for the model
uncertainty is necessary to guarantee a decent coverage (higher
than 85%). At horizons above the minute scale, the forecast
uncertainty is instead dominant. As example, Fig. 8 shows
forecast and model bounds for 1 s and 1 min forecast horizons,
see Fig. 8a and 8b, respectively. It is possible to see that at
1 s horizon the model bounds are of bigger magnitude and
are necessary to guarantee the target coverage probability. On
the contrary, above 1 min horizon the forecast uncertainty
is higher, and it has the highest contribution to the global
coverage. From Table II we can see that the global CP is lower
than ↵only at low forecast horizon (second and sub-second)
with curtailment, highlighted with underlines. This is due to
the fact that the selected maximum power estimator (based
on measurements of the PV system) is very sensitive to the
operating conditions, and a higher modeling error is expected
when the system is far from MPPT conditions. However, in
common plants, the modeling error can be computed only
with respect to a ground truth value obtained by leaving the
system in MPPT and comparing the measured and estimated
COVERAGE PROBABILITY-CP [%], FOR ↵= 95%. RESULTS ARE SHOWN FROM 100 MS TO 5 MIN FORECAST HORIZON. UNDERLINES REFER TO GLOBAL
CP LOWER THAN ↵.
Global Uncertainty
Forecast Horizon
Forecast Uncertainty
Model Uncertainty
NORMALIZED AVERAGE WIDTH-AW [%], FOR ↵= 95%. RESULTS ARE SHOWN FROM 100 MS TO 5 MIN FORECAST HORIZON.
Global Uncertainty
Forecast Horizon
Forecast Uncertainty
Model Uncertainty
Local Time [hours]
AC Power [W]
Realization
(a) Prediction Uncertainty, 1 s forecast horizon
Local Time [hours]
(b) Prediction Uncertainty, 1 min forecast horizon
Fig. 8. Comparison of the forecast bounds, model bounds, and realizations. One day of active power generation is shown for the experimental setup described
in Section II.
power. Thus, the error deﬁned in Eq. (7) only accounts
for MPPT and not for curtailed conditions. This explains
the lower coverage of the bounds when curtailment actions
are adopted. Furthermore, this higher modeling error affects
the global CP only at low horizons (lower than the minute
scale), i.e. when accounting for the modeling error is more
relevant. To understand the higher error associated with the DC
maximum power estimation when far from MPPT, we perform
a sensitivity analysis with respect to the model’s parameters.
In particular, we change one-factor-at-a-time (OAT approach),
 . Fig. 9 shows the sensitivity of the DC maximum power
estimation ( ˜Pdc) with respect to the parameters iD, nr, and Rs.
We recall from Section III-A1 that, these parameters, together
with Rp and Ip, are computed from datasheet parameters at
STC and then updated to account for their dependency of the
temperature and irradiance. The sensitivity is done considering
two values of irradiance (500 and 800 W/m2) and constant
temperature. For this assessment we consider that the initial
operating point of the PV system can be MPPT, open circuit
(OC), and curtailed (CUR, for this case we select a point
halfway between MPPT and OC). We observe that when
operating far from MPPT, the estimation is very sensitive to the
values of iD and nr. For example, an error on the estimation
of nr of 10% can lead to an 80% error on the estimation of
the DC maximum power when the system operates close to
OC conditions. The value of the series resistance Rs similarly
affects the MPPT and curtailed conditions, and less affects OC
conditions.
We can conclude that when referring to forecast horizons
below 1 minute, where the model uncertainty prevails in the
deﬁnition of the global power prediction uncertainty, it is
particularly important to invest in an accurate model of the PV
model and precise equations that account for the dependency
of the ﬁve parameters on the weather conditions.
C. Setpoint Tracking Uncertainty Assessment
In this section we quantify the uncertainty produced by
the power converter to track external setpoints. We recall
from Sections III-A5 and III-B that for a given request
u = (P ⇤, Q⇤), we have a set of possible injections (P, Q),
and a corresponding set of possible distances dP(u)
P ⇤−P(u) and dQ(u) = Q⇤−Q(u). In order to assess
the uncertainty associated with the setpoint implementation,
we perform several tests by sending to the converter different
requests u, sweeping the whole PQ admissible set, with a
step size of 100 W/100 VAr, for the active and reactive power
Parameter iD (per unit change)
DC Power (per unit change)
MPPT G=500 W/m2,
MPPT, G=800 W/m2
(a) Sensitivity on iD
Parameter nr (per unit change)
(b) Sensitivity on nr
Parameter Rs (per unit change)
(c) Sensitivity on Rs
Fig. 9. Per unit change of the DC maximum power estimation with respect to the per unit change of the input parameter. The base unit quantities of the DC
maximum power and of the parameters are those originally obtained from the model in .
respectively6. The quantiles deﬁning Ps are extracted from
the dP(u) and dQ(u) distributions recorded during these offline tests. As example, Fig. 10 shows the quantiles (δ#
for a conﬁdence level ↵= 95% and for different couples
(P ⇤, Q⇤). Similar results are obtained for Q. The quantiles
can be stored in a 2D look-up table that returns in real-time
the quantiles (δ"
P ) and (δ"
Q) as a function of a given
request (P ⇤, Q⇤). Fig. 10 shows that this uncertainty can reach
magnitudes of 600 W that corresponds to ⇡5% of the plant
rated power. Section V illustrates how to formally include this
uncertainty in the overall process, and ﬁnally deﬁne B↵(u).
  
Setpoints Tracking Uncertainty on Active Power.
V. APPLICATION: PV AGENT DESIGN
We show here how it is possible to combine the discussed
models and uncertainties to design an agent for a PV system
that is meant to periodically inform a grid controller (GC)
about the PV plant capabilities. Recall from Section III that
these capabilities may continuously change as a function of
the external perturbation w and the converter limitations e.
Inspired by , we deﬁne two elements that can represent the
way the PV system can be controlled (i) the Power Flexibility
A and (ii) the Controllability Uncertainty B. Note that, the
PV Agent looks for expressing the controllability of the PV
system at a given time-period in the future, i.e., at the time
when it expects to receive a new power setpoint. We assume
that, if the GC sends setpoints fast enough, the information
generated by the PV Agent can be computed in discrete-time,
6Each test lasts until the maximum available power is reached, accordingly
to given irradiance and temperature conditions.
considering that it remains constant between two consecutive
time-steps. Therefore, we target to have a message update in
the sub-second scale so that we can cope with the fastest
dynamics of real PV systems. This serves to simplify the
information sent to the GC without the need of explicitly
including the time dependence of the external perturbations
between consecutive time-steps. We next describe how to
compute these two elements.
A. Power Flexibility A
In general, we consider that the power ﬂexibility of a
controllable PV system can be deﬁned as a function of (i) the
predicted maximum available power P "↵
t+1, (ii) the converter
rated power Sr, and (iii) a minimum power factor constraint
PFmin. This last is typically required to minimize the reactive
power ﬂows in the grid and to comply with quality-of-service
norms, generally associated to voltage control.
As for the analysis presented in Section III, the maximum
available power is deﬁned by the upper bound of the global
prediction bound, P "↵
t+1. Considering this, and S = P +jQ as
the complex power, we deﬁne A as the set in the PQ-plane
where a GC can request a setpoint u in the next time-step,
i.e., ut+1 2 At. This is,
At ={(P, Q) 2 IR2|
0 P P "↵
||S|| ≥PFmin, ||S|| Sr}
The graphical representation of A is shown in Fig. 11.
Fig. 11. PV system Power Flexibility.
B. Controllability Uncertainty B
As previously shown in Section III, the uncertainty of
implementing a given setpoint is strongly dependent on two
factors (i) the maximum available AC power (from forecast
and model) and (ii) the setpoint tracking accuracy. Let us ﬁrst
focus on the former. The set deﬁned by the uncertainty of
the maximum available power, is a segment that depends on
PFmin. The deﬁnition for any ut+1 = (P ⇤
t+1) 2 At is
in Eq. (14). P 0
t+1 and Q0
t+1 are expressed as:
t+1 tan(arccos(PFmin)),
t+1 = sign(Q⇤
The graphical representation is shown in Fig. 12a.
Now, as presented in Section III-A5, the uncertainty of
the power converter to deploy a power setpoint is deﬁned
by Eq. (10). The set deﬁned by this uncertainty for any
t+1) 2 At, shown in Fig. 12b, is thus:
2,t(ut+1) = R↵(ut+1).
The overall uncertainty on deploying a power setpoint ut+1
can be, therefore, written as follows (see Fig. 12c):
t (ut+1) =
2,t(ut+1).
The two quantities A, B↵can be sent to the GC upon
request. Namely, upon reception of a setpoint ut, the agent will
compute Xt = (At, B↵
t ) that represents how the PV system
will be able to implement a setpoint at instant t + ∆t. Since
the proposed tool is capable of computing B↵for different
forecast horizons, the value of ∆t can be either a deﬁned apriori or in real-time along with the setpoint. In practice, the
GC and the PV Agent should agree on a message format for
both u and X, so that the communication burden is minimized.
For instance, if the GC knows beforehand the shape of sets A
and R, the PV Agent could only send (P "↵
t+1, Sr, PFmin) for
A and the parameters of the rectangle that deﬁnes the setpoint
tracking uncertainty, R↵(u), Ps = {δ#↵
u 2 A) to represent B↵.
VI. DISCUSSION
A. Extension to Energy Dispatch
In this paper we have focused on the uncertainty assessment
of the one-step-ahead power production of a PV plant, including the implementation uncertainty produced by the setpoint
tracking algorithm of the PV converter. However, a similar
strategy can be used for longer-term problems. For example,
in an energy dispatch problem (e.g. , ), the proposed
modelling chain can provide a predeﬁned coverage interval
that represents the expected uncertainties of the injected power
for multiple time steps in a given time horizon, together with
the explicit uncertainties for a given power setpoints.
B. Deployment of the Method in a Real-World Scenario
In this section, we describe the steps to be undertaken by a
modeller interested in implementing the proposed methodology, independently of the location and the weather conditions
of the PV plant.
• The PV module datasheet is used to compute the value
of the 5 parameters of the single-diode model, as in .
• Few days of locally collected measurements of the DC
voltage, current, and cell temperature are needed to train
the forecasting algorithm and the modelling errors model.
However, a periodical retraining is advisable to account
for seasonal dynamics. Alternatively, a clear-sky model
for the power can be introduced to remove seasonal and
daily deterministic dynamics, as proposed in .
• Measurements of the DC voltage, DC current, and AC
active power are needed to assess off-line the converter
efﬁciency and the setpoint uncertainty. The experiment
should sweep the whole PQ capability set of the converter. We note that this information might also be
provided by the manufacturer of the converter.
• On-line measurements of the DC voltage, current, and
cell temperature are needed to reconstruct the maximum
available power, that is then used as input for the forecasting and modelling error models (previously built off-line).
VII. CONCLUSION
Due to the inherent short-term variability of solar irradiance,
predictive control coupled with accurate stochastic models is
considered as a suitable way to achieve the controllability of
PV generation. This paper tackles the problem of assessing
the uncertainty associated with the operation of a controllable
PV facility. The analysis included two fundamental aspects:
determining the PV generation potential for the next time
interval (allowing to identify a region inside the capability
curve of the power converter from where it is possible to pick a
power setpoint), and characterizing the uncertainty associated
to tracking a setpoint inside that region. The former element is
determined by using a short-term forecasting method, whereas
the latter depends on the converter internal dynamics and is
evaluated with a data-driven approach. The proposed grey-box
modelling relies on physical models as well as on measurements of the PV currents, voltages, and the cell temperature,
all information normally available to the PV plant operator,
without the use of extra sensors (e.g., pyranometers). The
proposed method was tested considering different forecasting
horizons, from 100 ms to 5 minutes ahead. Experimental
results showed that, when considering forecasting horizons
below 1 minute, accurate physical models are the key to
achieve reliable coverage of the prediction interval. On the
other hand, for forecasting horizons larger than 1 minute, the
quality of the predictions is mostly affected by the uncertainty
associated with the forecasting, which becomes dominant with
respect to models performance. As an application, we have
shown how the proposed model can be integrated into a
predictive control logic for a PV power plant, which can
be used to control PV generation in combination with other
distributed energy resources.
1,t(ut+1) =
t+1), (P 0
t+1)] [ [(P 0
t+1), (P #↵
B1(P1, Q1)
B1(P2, Q2)
B1(P3, Q3)
(a) Maximum available power
B2(P1, Q1)
B2(P2, Q2)
B2(P3, Q3)
(b) Setpoint tracking accuracy
(c) Overall uncertainty
Fig. 12. Examples of Controllability Uncertainty. The subscripts represent three different possible setpoints.